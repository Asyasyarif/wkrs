<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis Interaktif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 5px rgba(59, 130, 246, 0.5);
            }
            50% {
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.8), 0 0 30px rgba(59, 130, 246, 0.6);
            }
        }
        
        .bounce-animation {
            animation: bounce 1s infinite;
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        .slide-in {
            animation: slideIn 0.6s ease-out;
        }
        
        .glow-effect {
            animation: glow 2s infinite;
        }
        
        .progress-bar-animated {
            background: linear-gradient(90deg, #ec4899, #8b5cf6, #06b6d4, #10b981);
            background-size: 200% 100%;
            animation: gradient 3s ease infinite;
        }
        
        @keyframes gradient {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        
        .celebration-bg {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57);
            background-size: 400% 400%;
            animation: gradientShift 4s ease infinite;
        }
        
        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        
        .winner-crown {
            position: relative;
        }
        
        .winner-crown::before {
            content: "üëë";
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2rem;
            animation: bounce 1s infinite;
        }
        
        .food-item {
            transition: all 0.3s ease;
            cursor: pointer;
            width: 100%;
            height: 120px;
            overflow: visible;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            border: 2px solid transparent; /* cegah loncat layout saat selected */
            box-sizing: border-box;
        }
        
        .food-item:hover {
            z-index: 10;
        }
        
        .food-item img {
            max-width: 100%;
            max-height: 100%;
            min-width: 135px;
            min-height: 120px;
            width: auto;
            height: auto;
            object-fit: contain;
            transition: all 0.3s ease;
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, .5));
        }

        

        .food-item.selected img {
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, .5))
                    drop-shadow(0 0 10px rgba(255, 255, 255, 0.95))
                    drop-shadow(0 0 18px rgba(255, 255, 255, 0.65));
        }
        /* Hapus styling lingkaran lama */
        
        .food-item:hover img {
            transform: scale(1.15) rotate(var(--hover-rotate, 0deg));
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.9))
                    drop-shadow(0 0 40px rgba(255, 255, 255, 0.7))
                    drop-shadow(0 0 60px rgba(255, 255, 255, 0.5));
        }

        /* Marker-pen overlay */
        .pen-overlay {
            position: absolute;
            inset: 0;
            pointer-events: none;
            display: none;
        }
        .food-item.selected .pen-overlay { display: block; }
        .pen-overlay svg { position: absolute; left: 0; top: 0; width: 100%; height: 100%; z-index: 5; }
        .pen-overlay path {
            stroke: rgba(255, 255, 255, 0.95);
            stroke-width: 6;
            fill: none;
            stroke-linecap: round;
            filter: drop-shadow(0 0 6px rgba(255,255,255,.55)) drop-shadow(0 0 14px rgba(255,255,255,.35));
            transition: stroke-dashoffset 360ms linear;
        }
        
        #newSessionBtn:hover {
            background-color: #B85A15;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        #newSessionBtn:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        .participant-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }
        
        .participant-card.has-placeholder {
            background-color: transparent !important;
            border: 2px dashed rgba(255, 255, 255, 0.5);
            box-shadow: none;
            padding: 0;
            width: 72px !important;
            min-width: 72px !important;
            border-radius: 50% !important;
            justify-content: center;
        }
        
        .participant-card.has-placeholder:hover {
            border-color: rgba(255, 255, 255, 0.8);
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .participant-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .participant-placeholder div {
            padding: 4px;
        }
        
        .participant-info {
            display: none;
        }
        
        .participant-info.show {
            display: flex !important;
        }
        
        #participantModal {
            display: none;
        }
        
        #participantModal.show {
            display: flex !important;
        }
        
        #closeModalBtn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .clear-participant-btn:hover {
            background: rgba(255, 0, 0, 0.2);
            border-color: rgba(255, 0, 0, 0.5);
            transform: scale(1.1);
        }
        
        .clear-participant-btn:active {
            transform: scale(0.95);
        }
        
        .participant-option:hover {
            border-color: #4CAF50 !important;
            background-color: #f9f9f9 !important;
        }
        
        #swal-item-quantity {
            width: 100% !important;
            box-sizing: border-box !important;
            margin: 0 !important;
        }
        
        .swal2-html-container {
            border-radius: 50px !important;
            padding: 1 !important;
        }
        
        #viewResultsBtn:hover {
            background-color: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        #viewResultsBtn:active {
            transform: translateY(0);
        }
        
        .results-popup {
            border-radius: 25px !important;
        }
        
        /* Pastikan canvas confetti muncul di atas SweetAlert */
        canvas {
            z-index: 999999 !important;
            pointer-events: none !important;
        }
        
        .swal2-container {
            z-index: 1060 !important;
        }
    </style>
</head>
<body style="margin: 0; padding: 0; overflow: hidden; height: 100vh; background-color: #311E0C;">
    <div style="
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        width: 100vw;
        position: relative;
    ">
        <!-- Info Partisipan -->
        <div style="
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 9px;
        ">
            <button id="quickResultsBtn" style="
                display: none;
                align-self: flex-start;
                background-color: #4CAF50;
                color: #ffffff;
                padding: 8px 14px;
                border: none;
                border-radius: 14px;
                font-size: 12px;
                font-weight: 700;
                cursor: pointer;
                box-shadow: 0 2px 8px rgba(0,0,0,.2);
                transition: all .2s ease;
                margin-bottom: 6px;
            ">Lihat Hasil</button>
            <div class="participant-card" data-participant="0" style="
                min-width: 72px;
                height: 72px;
                background-color: rgba(255, 255, 255, 0.95);
                border-radius: 36px;
                display: flex;
                flex-direction: row;
                align-items: center;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
                cursor: pointer;
                transition: all 0.3s ease;
                overflow: hidden;
            ">
                <div id="participant-placeholder-0" class="participant-placeholder" style="width: 72px; height: 72px;">
                    <div style="font-size: 29px; font-weight: bold; color: #666;">+</div>
                </div>
                <div id="participant-info-0" class="participant-info" style="flex: 1; flex-direction: row; align-items: center; justify-content: space-between; height: 100%;">
                    <div style="display: flex; flex-direction: row; align-items: center; flex: 1;">
                        <img id="participant-avatar-0" src="" alt="Avatar" style="width: 72px; height: 72px; border-radius: 50%; object-fit: cover; flex-shrink: 0;">
                        <div style="padding: 8px 12px; flex: 1;">
                            <div id="participant-name-0" style="font-weight: bold; font-size: 11px; margin-bottom: 4px; color: #333;"></div>
                            <div id="participant-food-0" style="display: none; font-size: 8px; color: #666; margin-bottom: 2px;"></div>
                            <div id="participant-drink-0" style="display: none; font-size: 8px; color: #666;"></div>
                        </div>
                    </div>
                    
                </div>
            </div>
            
            <div class="participant-card" data-participant="1" style="
                min-width: 72px;
                height: 72px;
                background-color: rgba(255, 255, 255, 0.95);
                border-radius: 36px;
                display: flex;
                flex-direction: row;
                align-items: center;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
                cursor: pointer;
                transition: all 0.3s ease;
                overflow: hidden;
            ">
                <div id="participant-placeholder-1" class="participant-placeholder" style="width: 72px; height: 72px;">
                    <div style="font-size: 29px; font-weight: bold; color: #666;">+</div>
                </div>
                <div id="participant-info-1" class="participant-info" style="flex: 1; flex-direction: row; align-items: center; justify-content: space-between; height: 100%;">
                    <div style="display: flex; flex-direction: row; align-items: center; flex: 1;">
                        <img id="participant-avatar-1" src="" alt="Avatar" style="width: 72px; height: 72px; border-radius: 50%; object-fit: cover; flex-shrink: 0;">
                        <div style="padding: 8px 12px; flex: 1;">
                            <div id="participant-name-1" style="font-weight: bold; font-size: 11px; margin-bottom: 4px; color: #333;"></div>
                            <div id="participant-food-1" style="display: none; font-size: 8px; color: #666; margin-bottom: 2px;"></div>
                            <div id="participant-drink-1" style="display: none; font-size: 8px; color: #666;"></div>
                        </div>
                    </div>
                    
                </div>
            </div>
            
            <!-- Tombol Lihat Hasil -->
            <!-- <button id="viewResultsBtn" style="
                width: 100%;
                background-color: #4CAF50;
                color: white;
                padding: 10px 20px;
                border: none;
                border-radius: 20px;
                font-size: 14px;
                font-weight: bold;
                cursor: pointer;
                margin-top: 15px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
                transition: all 0.3s ease;
            ">
                Lihat Hasil
            </button> -->
        </div>

        <!-- Modal Avatar Full Screen -->
        <div id="participantModal" style="
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        ">
            <div style="
                display: flex;
                align-items: center;
                gap: 60px;
                padding: 40px;
                max-width: 90%;
            ">
                <div style="
                    flex-shrink: 0;
                ">
                    <img id="modal-avatar" src="" alt="Avatar" style="
                        width: 400px;
                        height: 400px;
                        border-radius: 50%;
                        object-fit: cover;
                        border: 6px solid white;
                        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
                    ">
                </div>
                <div style="
                    flex: 1;
                    color: white;
                ">
                    <h2 id="modal-name" style="
                        font-size: 48px;
                        font-weight: bold;
                        margin-bottom: 40px;
                        color: white;
                    "></h2>
                    <div style="
                        font-size: 32px;
                        line-height: 1.8;
                    ">
                        <div id="modal-food" style="margin-bottom: 20px;">
                            Makanan <span id="modal-food-count">0</span>/<span id="modal-food-total">2</span>
                        </div>
                        <div id="modal-drink">
                            Minuman <span id="modal-drink-count">0</span>/<span id="modal-drink-total">1</span>
                        </div>
                    </div>
                </div>
                <button id="closeModalBtn" style="
                    position: absolute;
                    top: 30px;
                    right: 30px;
                    background: rgba(255, 255, 255, 0.2);
                    border: 2px solid white;
                    color: white;
                    width: 50px;
                    height: 50px;
                    border-radius: 50%;
                    font-size: 24px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                ">√ó</button>
            </div>
        </div>

        <div style="
            width: 1000px;
            height: auto;
            background-image: url('assets/bg.png');
            background-size: contain;
            background-position: center center;
            background-repeat: no-repeat;
            /* border: 10px solid white; */
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            padding: 32px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 800px;
        ">

        <!-- Grid Etalase Makanan -->
            <div id="foodGrid" style="
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 1.5em .2em;
                margin-top: 80px;
                padding: 10px;
            ">
            </div>

       
        <!-- <div class="bg-yellow-50 rounded-2xl shadow-xl p-8 mb-8 border-2 border-yellow-300">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3">
                    <div class="w-4 h-4 bg-pink-600 rounded-full shadow-sm"></div>
                    <span class="text-lg font-bold text-purple-800">Progress Review</span>
                </div>
                <div class="bg-red-600 text-white px-6 py-2 rounded-lg font-bold text-lg shadow-lg">
                    <span id="progressText">1 / 1</span>
                </div>
            </div>
            <div class="w-full bg-pink-200 rounded-full h-6 overflow-hidden shadow-inner">
                <div id="progressBar" class="progress-bar-animated h-6 rounded-full transition-all duration-1000 ease-out shadow-lg glow-effect" style="width: 0%"></div>
            </div>
        </div>


        <div class="bg-cyan-50 rounded-2xl shadow-2xl p-10 mb-8 border-2 border-cyan-300 transform hover:shadow-3xl transition-all duration-500">
            <div class="text-center">
                <div class="mb-8">
                    <div class="inline-block bg-indigo-600 text-white px-6 py-3 rounded-xl text-lg font-bold shadow-lg">
                        Pertanyaan <span id="questionNumber">1</span> dari <span id="totalQuestions">1</span>
                    </div>
                </div>
                
                <div class="bg-emerald-50 rounded-2xl p-8 mb-8 border-2 border-emerald-300 shadow-inner">
                    <h2 id="questionText" class="text-3xl font-bold text-emerald-900 mb-8 leading-relaxed">
                        
                    </h2>
                </div>
            </div>
        </div>

  
        <div class="flex justify-between items-center mb-12">
            <button id="prevBtn" 
                class="group bg-violet-600 text-white px-10 py-5 rounded-2xl hover:bg-violet-700 focus:outline-none focus:ring-4 focus:ring-violet-300 focus:ring-offset-2 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed shadow-xl hover:shadow-2xl transform hover:scale-105 disabled:hover:scale-100">
                <div class="flex items-center gap-3">
                    <span class="text-2xl font-bold">‚Üê</span>
                    <span class="text-xl font-bold">Sebelumnya</span>
                </div>
            </button> -->
            
            <!-- <div class="flex items-center gap-6">
                <div class="text-center">
                    <div class="text-sm text-purple-600 mb-2 font-semibold">Keyboard Shortcuts</div>
                    <div class="flex gap-3">
                        <span class="bg-orange-200 text-orange-800 px-3 py-2 rounded-lg text-sm font-bold">‚Üê</span>
                        <span class="bg-orange-200 text-orange-800 px-3 py-2 rounded-lg text-sm font-bold">‚Üí</span>
                    </div>
                </div>
            </div> 
            
            <button id="nextBtn" 
                class="group bg-rose-600 text-white px-10 py-5 rounded-2xl hover:bg-rose-700 focus:outline-none focus:ring-4 focus:ring-rose-300 focus:ring-offset-2 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed shadow-xl hover:shadow-2xl transform hover:scale-105 disabled:hover:scale-100">
                <div class="flex items-center gap-3">
                    <span id="nextBtnText" class="text-xl font-bold">Selanjutnya</span>
                    <span id="nextBtnIcon" class="text-2xl font-bold">‚Üí</span>
                </div>
            </button>-->
        </div>


        <div id="resultsSection" class="hidden">
            <div class="celebration-bg rounded-2xl shadow-2xl p-10 mb-8 border-4 border-yellow-300 slide-in">
                <div class="text-center">
                    
                    <!-- Winner Announcement -->
                    <div id="winnerAnnouncement" class="bg-white bg-opacity-95 rounded-2xl p-8 mb-8 border-4 border-yellow-400 shadow-2xl pulse-animation">
                        <div class="text-center">
                            <div class="text-5xl mb-4">üèÜ</div>
                            <h4 class="text-3xl font-bold text-gray-800 mb-2">PEMENANG UTAMA</h4>
                            <div id="winnerName" class="text-4xl font-black text-yellow-600 winner-crown"></div>
                            <div id="winnerScore" class="text-2xl font-bold text-gray-700 mt-2"></div>
                        </div>
                    </div>
                    
                    <!-- Results Table -->
                    <div class="bg-white bg-opacity-95 rounded-2xl p-8 mb-8 border-4 border-blue-300 shadow-2xl">
                        <h3 class="text-3xl font-bold text-gray-900 mb-8 text-center">üèÖ Peringkat Semua Peserta üèÖ</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse">
                                <thead>
                                    <tr class="bg-gradient-to-r from-purple-500 via-pink-500 to-red-500 text-white">
                                        <th class="border border-gray-300 px-8 py-6 text-left font-bold text-xl">Peringkat</th>
                                        <th class="border border-gray-300 px-8 py-6 text-left font-bold text-xl">Peserta</th>
                                        <th class="border border-gray-300 px-8 py-6 text-center font-bold text-xl">Skor</th>
                                    </tr>
                                </thead>
                                <tbody id="resultsTableBody">
                                    <!-- Results will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="flex justify-center gap-6">
                        <button id="backToQuiz" 
                            class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-12 py-6 rounded-2xl hover:from-purple-700 hover:to-pink-700 focus:outline-none focus:ring-4 focus:ring-purple-300 focus:ring-offset-2 transition-all duration-300 shadow-xl hover:shadow-2xl transform hover:scale-105 pulse-animation">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl">üîÑ</span>
                                <span class="text-xl font-bold">Kembali ke Kuis</span>
                            </div>
                        </button>
                        
                        <button id="celebrateBtn" 
                            class="bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-12 py-6 rounded-2xl hover:from-yellow-600 hover:to-orange-600 focus:outline-none focus:ring-4 focus:ring-yellow-300 focus:ring-offset-2 transition-all duration-300 shadow-xl hover:shadow-2xl transform hover:scale-105">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl">üéä</span>
                                <span class="text-xl font-bold">Rayakan Lagi!</span>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>



        </div>

    <!-- Tombol Buat Sesi Baru -->
    <div style="
        position: absolute;
        bottom: 20px;
        right: 20px;
    ">
        <button id="newSessionBtn" style="
            background-color: #CB6917;
            color: #ffffff;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        ">
            Buat Sesi Baru
        </button>
    </div>
    </div>

    <script src="script.js"></script>
    <script>
        let questions = [];
        let participants = [];
        let answers = {}; // Format: { participantIndex: { questionIndex: answer } }
        let currentQuestionIndex = 0;
        let currentParticipantIndex = 0;

        let participantsData = [null, null]; // Array untuk menyimpan data 2 partisipan

        // Global state untuk item terpilih (disimpan di localStorage)
        let selectedItemIds = new Set();
        let selectedItems = [];

        function loadSelectedItems() {
            try {
                // Prefer full objects
                const savedObjs = localStorage.getItem('selectedItems');
                if (savedObjs) {
                    const arr = JSON.parse(savedObjs);
                    if (Array.isArray(arr)) {
                        selectedItems = arr;
                        selectedItemIds = new Set(arr.map(o => Number(o.id)));
                        return;
                    }
                }
                // Backward compatibility: ids only
                const savedIds = localStorage.getItem('selectedItemIds');
                if (savedIds) {
                    const arr = JSON.parse(savedIds);
                    if (Array.isArray(arr)) {
                        selectedItemIds = new Set(arr.map(Number));
                        selectedItems = Array.from(selectedItemIds).map(id => menuItems.find(m => m.id === id)).filter(Boolean);
                    }
                }
            } catch (e) { /* ignore */ }
        }

        function saveSelectedItems() {
            try {
                localStorage.setItem('selectedItemIds', JSON.stringify(Array.from(selectedItemIds)));
                localStorage.setItem('selectedItems', JSON.stringify(selectedItems));
            } catch (e) { /* ignore */ }
        }

        $(document).ready(function() {
            loadSelectedItems();
            loadParticipants();
            renderFoodItems();
            loadQuestions();
            initializeEventListeners();
            initializeParticipantCards();
            updateParticipantDisplay();
            updateSelectedVisuals();
            updateQuickResultsButton();
        });

        function allParticipantsComplete() {
            const availableParticipants = participantsData.filter(p => p !== null);
            if (availableParticipants.length === 0) return false;
            for (const participant of availableParticipants) {
                const foodItems = participant.items ? participant.items.filter(item => {
                    const menuItem = menuItems.find(m => m.id === item.itemId);
                    return menuItem && menuItem.type === 'makanan';
                }) : [];
                const drinkItems = participant.items ? participant.items.filter(item => {
                    const menuItem = menuItems.find(m => m.id === item.itemId);
                    return menuItem && menuItem.type === 'minuman';
                }) : [];
                if (foodItems.length !== 2 || drinkItems.length !== 1) return false;
            }
            return true;
        }

        function maybeAutoShowResults() {
            // Tampilkan hasil otomatis jika semua partisipan sudah 2 makanan + 1 minuman
            if (allParticipantsComplete()) {
                // Sedikit delay agar UI sinkron terlebih dahulu
                setTimeout(() => {
                    showAllResults();
                }, 200);
            }
        }

        function saveParticipants() {
            localStorage.setItem('participantsData', JSON.stringify(participantsData));
        }

        function loadParticipants() {
            const saved = localStorage.getItem('participantsData');
            if (saved) {
                try {
                    participantsData = JSON.parse(saved);
                } catch (e) {
                    participantsData = [null, null];
                }
            }
            // Set default Player 1 & Player 2 jika belum ada
            if (!participantsData[0]) {
                participantsData[0] = { name: 'Player 1', total: 0, items: [] };
            }
            if (!participantsData[1]) {
                participantsData[1] = { name: 'Player 2', total: 0, items: [] };
            }
            saveParticipants();
        }

        function initializeParticipantCards() {
            // Nonaktifkan view detail partisipan (klik kartu tidak melakukan apa-apa)
            $('.participant-card').on('click', function() {
                return;
            });
            
            // Fitur hapus partisipan dihapus
            
            // Close modal handlers
            $('#closeModalBtn').on('click', function() {
                hideParticipantModal();
            });
            
            $('#participantModal').on('click', function(e) {
                if (e.target === this) {
                    hideParticipantModal();
                }
            });
        }
        
        // Fitur hapus partisipan dihapus
        
        function showParticipantModal(index) {
            const participant = participantsData[index];
            if (!participant) return;
            
            // Calculate food and drink counts
            const foodItems = menuItems.filter(item => item.type === 'makanan');
            const drinkItems = menuItems.filter(item => item.type === 'minuman');
            
            const selectedFood = participant.items ? participant.items.filter(item => {
                const menuItem = menuItems.find(m => m.id === item.itemId);
                return menuItem && menuItem.type === 'makanan';
            }).length : 0;
            
            const selectedDrink = participant.items ? participant.items.filter(item => {
                const menuItem = menuItems.find(m => m.id === item.itemId);
                return menuItem && menuItem.type === 'minuman';
            }).length : 0;
            
            // Set avatar
            const avatarUrl = `https://api.dicebear.com/9.x/notionists-neutral/svg?seed=${encodeURIComponent(participant.name)}`;
            $('#modal-avatar').attr('src', avatarUrl);
            
            // Set name
            $('#modal-name').text(participant.name);
            
            // Set counts
            $('#modal-food-count').text(selectedFood);
            $('#modal-food-total').text(2);
            $('#modal-drink-count').text(selectedDrink);
            $('#modal-drink-total').text(1);
            
            // Show modal
            $('#participantModal').addClass('show');
        }
        
        function hideParticipantModal() {
            $('#participantModal').removeClass('show');
        }

        function addParticipant(index) {
            // Dinonaktifkan: partisipan default Player 1 & Player 2
            return;
        }

        function editParticipant(index) {
            // Dinonaktifkan: tidak ada edit nama
            return;
        }

        function clearSession() {
            Swal.fire({
                title: 'Buat Sesi Baru?',
                text: 'Semua data partisipan dan item yang dipilih akan dihapus. Tindakan ini tidak dapat dibatalkan.',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Ya, Hapus Semua',
                cancelButtonText: 'Batal',
                confirmButtonColor: '#d32f2f',
                cancelButtonColor: '#6c757d'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Reset in-memory states
                    participantsData = [
                        { name: 'Player 1', total: 0, items: [] },
                        { name: 'Player 2', total: 0, items: [] }
                    ];
                    selectedItemIds = new Set();
                    selectedItems = [];
                    
                    // Clear ALL localStorage
                    try { localStorage.clear(); } catch(e) {}
                    // Persist default players back
                    try { localStorage.setItem('participantsData', JSON.stringify(participantsData)); } catch(e) {}
                    
                    // Update tampilan & visual markers
                    updateParticipantDisplay();
                    updateSelectedVisuals();
                    updateQuickResultsButton && updateQuickResultsButton();
                    
                    // Show success message
                    Swal.fire({
                        title: 'Berhasil!',
                        text: 'Semua data dan pilihan telah dibersihkan. Sesi baru siap.',
                        icon: 'success',
                        confirmButtonText: 'OK',
                        confirmButtonColor: '#4CAF50'
                    });
                }
            });
        }

        function updateParticipantDisplay() {
            const foodItems = menuItems.filter(item => item.type === 'makanan');
            const drinkItems = menuItems.filter(item => item.type === 'minuman');
            
            for (let i = 0; i < 2; i++) {
                const participant = participantsData[i];
                const $card = $(`.participant-card[data-participant="${i}"]`);
                const $placeholder = $(`#participant-placeholder-${i}`);
                const $info = $(`#participant-info-${i}`);
                const $name = $(`#participant-name-${i}`);
                const $avatar = $(`#participant-avatar-${i}`);
                const $foodCount = $(`#participant-food-count-${i}`);
                const $foodTotal = $(`#participant-food-total-${i}`);
                const $drinkCount = $(`#participant-drink-count-${i}`);
                const $drinkTotal = $(`#participant-drink-total-${i}`);
                
                if (participant) {
                    // Tampilkan info partisipan
                    $card.removeClass('has-placeholder');
                    $placeholder.hide();
                    $info.addClass('show');
                    
                    $name.text(participant.name);
                    
                    // Set avatar menggunakan nama sebagai seed
                    const avatarUrl = `https://api.dicebear.com/9.x/notionists-neutral/svg?seed=${encodeURIComponent(participant.name)}`;
                    $avatar.attr('src', avatarUrl);
                    
                    // Calculate food and drink counts
                    const selectedFood = participant.items ? participant.items.filter(item => {
                        const menuItem = menuItems.find(m => m.id === item.itemId);
                        return menuItem && menuItem.type === 'makanan';
                    }).length : 0;
                    
                    const selectedDrink = participant.items ? participant.items.filter(item => {
                        const menuItem = menuItems.find(m => m.id === item.itemId);
                        return menuItem && menuItem.type === 'minuman';
                    }).length : 0;
                    
                    $foodCount.text(selectedFood);
                    $foodTotal.text(2);
                    $drinkCount.text(selectedDrink);
                    $drinkTotal.text(1);
                } else {
                    // Tampilkan placeholder
                    $card.addClass('has-placeholder');
                    $placeholder.show();
                    $info.removeClass('show');
                    $avatar.attr('src', '');
                }
            }
        }

        function renderFoodItems() {
            const $foodGrid = $('#foodGrid');
            $foodGrid.empty();
            
            menuItems.forEach(function(item) {
                const $foodItem = $('<div>')
                    .addClass('food-item')
                    .attr('id', item.id);
                const $img = $('<img>').attr({
                    'src': item.image,
                    'alt': item.name
                });
                $foodItem.append($img);
                
                // Marker-pen overlay (hidden by default, shown when selected)
                const $pen = $('<div class="pen-overlay"><svg viewBox="-1 -1 2 2"><path pathLength="1000" vector-effect="non-scaling-stroke"></path></svg></div>');
                $foodItem.append($pen);
                // Klik gambar/item: validasi kuota, toggle highlight + simpan ke localStorage
                $foodItem.on('click', function(e) {
                    e.stopPropagation();
                    const $el = $(this);
                    const idNum = Number($el.attr('id'));
                    const isCurrentlySelected = $el.hasClass('selected');
                    const mi = menuItems.find(m => m.id === idNum);
                    if (!mi) return;
                    
                    // Jika akan memilih (belum selected), cek limit 2 makanan & 1 minuman
                    if (!isCurrentlySelected) {
                        const foodCount = selectedItems.filter(s => s.type === 'makanan').length;
                        const drinkCount = selectedItems.filter(s => s.type === 'minuman').length;
                        if (mi.type === 'makanan' && foodCount >= 2) {
                            Swal.fire({
                                title: 'Perhatian',
                                text: 'Sudah memilih 2 makanan. Unselect salah satu dulu.',
                                icon: 'warning',
                                confirmButtonText: 'OK',
                                confirmButtonColor: '#FFA500'
                            });
                            return; // batal
                        }
                        if (mi.type === 'minuman' && drinkCount >= 1) {
                            Swal.fire({
                                title: 'Perhatian',
                                text: 'Sudah memilih 1 minuman. Unselect dulu untuk ganti.',
                                icon: 'warning',
                                confirmButtonText: 'OK',
                                confirmButtonColor: '#FFA500'
                            });
                            return; // batal
                        }
                    }
                    
                    // Lolos validasi ‚Üí toggle
                    $el.toggleClass('selected');
                    if ($el.hasClass('selected')) {
                        selectedItemIds.add(idNum);
                        if (!selectedItems.some(si => si.id === idNum)) selectedItems.push(mi);
                        drawMarker($el);
                    } else {
                        selectedItemIds.delete(idNum);
                        selectedItems = selectedItems.filter(si => si.id !== idNum);
                    }
                    saveSelectedItems();
                    maybeTriggerSelectionComplete();
                    updateQuickResultsButton();
                });
                $foodGrid.append($foodItem);
            });
            
            applyRandomRotation();
            initMarkers();
            updateSelectedVisuals();
        }

        function initMarkers() {
            $('.pen-overlay path').each(function() {
                const path = this;
                const len = path.getTotalLength ? path.getTotalLength() : 1000;
                path.style.strokeDasharray = len;
                path.style.strokeDashoffset = len;
                path.style.visibility = 'hidden';
            });
        }

        function drawMarker($item) {
            const path = $item.find('.pen-overlay path')[0];
            if (!path) return;
            path.setAttribute('d', circlePath(-0.12, 0.08, 120, 220, 0.03, 0.35));
            const len = path.getTotalLength ? path.getTotalLength() : 1000;
            path.style.visibility = 'visible';
            path.style.strokeDasharray = len;
            path.style.strokeDashoffset = len;
            // reflow to apply transition
            path.getBoundingClientRect();
            path.style.strokeDashoffset = 0;
        }

        function showMarkerNoAnim($item) {
            const path = $item.find('.pen-overlay path')[0];
            if (!path) return;
            path.setAttribute('d', circlePath(-0.12, 0.08, 120, 220, 0.03, 0.35));
            const len = path.getTotalLength ? path.getTotalLength() : 1000;
            path.style.visibility = 'visible';
            path.style.strokeDasharray = len;
            path.style.strokeDashoffset = 0;
        }

        function circlePath(dr_min, dr_max, t0_min, t0_max, dt_min, dt_max) {
            const c = 0.551915024494;
            const beta = Math.atan(c);
            let r = 1;
            let theta = ((t0_min + Math.random() * (t0_max - t0_min)) * Math.PI) / 180;
            const d = Math.sqrt(c * c + 1);
            let dstr = 'M';
            dstr += [r * Math.sin(theta), r * Math.cos(theta)];
            dstr += ' C' + [d * r * Math.sin(theta + beta), d * r * Math.cos(theta + beta)];
            for (let i = 0; i < 4; i++) {
                theta += (Math.PI / 2) * (1 + dt_min + Math.random() * (dt_max - dt_min));
                r *= 1 + dr_min + Math.random() * (dr_max - dr_min);
                dstr += ' ' + (i ? 'S' : '') + [d * r * Math.sin(theta - beta), d * r * Math.cos(theta - beta)];
                dstr += ' ' + [r * Math.sin(theta), r * Math.cos(theta)];
            }
            return dstr;
        }
        
        function updateSelectedVisuals() {
            $('.food-item').each(function() {
                const $el = $(this);
                const id = parseInt($el.attr('id'));
                const path = $el.find('.pen-overlay path')[0];
                if (selectedItemIds.has(id)) {
                    $el.addClass('selected');
                    // tampilkan marker tanpa animasi pada load
                    showMarkerNoAnim($el);
                } else {
                    $el.removeClass('selected');
                    if (path) {
                        const len = path.getTotalLength ? path.getTotalLength() : 1000;
                        path.style.strokeDasharray = len;
                        path.style.strokeDashoffset = len;
                        path.style.visibility = 'hidden';
                    }
                }
            });
            updateQuickResultsButton();
        }

        function updateQuickResultsButton() {
            const foodCount = selectedItems.filter(mi => mi.type === 'makanan').length;
            const drinkCount = selectedItems.filter(mi => mi.type === 'minuman').length;
            if (foodCount === 2 && drinkCount === 1) {
                $('#quickResultsBtn').css('display', 'inline-block');
            } else {
                $('#quickResultsBtn').css('display', 'none');
            }
        }

        function maybeTriggerSelectionComplete() {
            let foodCount = 0;
            let drinkCount = 0;
            selectedItems.forEach(mi => {
                if (!mi) return;
                if (mi.type === 'makanan') foodCount++;
                if (mi.type === 'minuman') drinkCount++;
            });
            if (foodCount === 2 && drinkCount === 1) {
                Swal.fire({
                    title: 'Masukkan Tebakan Harga',
                    html: `
                        <div style="text-align:left;">
                            <div style="margin-bottom:10px; font-weight:600;">Player 1</div>
                            <input type="number" id="guess-player-1" class="swal2-input" placeholder="Tebak harga Player 1" min="0" step="100" style="width:100%; box-sizing:border-box; margin:0;">
                            <div style="margin:14px 0 10px; font-weight:600;">Player 2</div>
                            <input type="number" id="guess-player-2" class="swal2-input" placeholder="Tebak harga Player 2" min="0" step="100" style="width:100%; box-sizing:border-box; margin:0;">
                        </div>
                    `,
                    focusConfirm: false,
                    showCancelButton: true,
                    cancelButtonText: 'Batal',
                    confirmButtonText: 'Lihat Hasil',
                    confirmButtonColor: '#4CAF50',
                    preConfirm: () => {
                        const p1 = parseInt(document.getElementById('guess-player-1').value, 10);
                        const p2 = parseInt(document.getElementById('guess-player-2').value, 10);
                        if (isNaN(p1) || p1 < 0) {
                            Swal.showValidationMessage('Masukkan tebakan harga Player 1 yang valid');
                            return false;
                        }
                        if (isNaN(p2) || p2 < 0) {
                            Swal.showValidationMessage('Masukkan tebakan harga Player 2 yang valid');
                            return false;
                        }
                        try {
                            localStorage.setItem('priceGuesses', JSON.stringify({ player1: p1, player2: p2 }));
                        } catch (e) {}
                        return { p1, p2 };
                    }
                }).then((res) => {
                    if (res.isConfirmed) {
                        // Tampilkan hasil perbandingan tebakan vs total harga
                        try { showPriceGuessResults(); } catch (e) {}
                    }
                });
            }
        }

        // Tampilkan hasil: hitung total harga selectedItems dan bandingkan tebakan Player 1 vs Player 2
        function showPriceGuessResults() {
            // Validasi jumlah pilihan (2 makanan, 1 minuman)
            const foodCount = selectedItems.filter(mi => mi.type === 'makanan').length;
            const drinkCount = selectedItems.filter(mi => mi.type === 'minuman').length;
            if (foodCount !== 2 || drinkCount !== 1) {
                Swal.fire({
                    title: 'Perhatian',
                    text: 'Pilih tepat 2 makanan dan 1 minuman terlebih dahulu.',
                    icon: 'warning',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#FFA500'
                });
                return;
            }

            // Ambil tebakan
            let guesses = null;
            try {
                const s = localStorage.getItem('priceGuesses');
                if (s) guesses = JSON.parse(s);
            } catch (e) {}
            if (!guesses || typeof guesses.player1 !== 'number' || typeof guesses.player2 !== 'number') {
                Swal.fire({
                    title: 'Perhatian',
                    text: 'Masukkan tebakan harga untuk Player 1 dan Player 2 dulu.',
                    icon: 'info',
                    confirmButtonText: 'OK'
                });
                return;
            }

            const totalPrice = selectedItems.reduce((sum, it) => sum + (it.price || 0), 0);
            const g1 = guesses.player1;
            const g2 = guesses.player2;

            // Logika: Price is Right (max lower, jika tidak ada ‚Üí min higher)
            const all = [
                { name: 'Player 1', value: g1 },
                { name: 'Player 2', value: g2 }
            ];
            const lower = all.filter(x => x.value <= totalPrice);
            let winner;
            if (lower.length > 0) {
                // Ambil yang terbesar tapi tidak melebihi total
                const maxLowerVal = Math.max(...lower.map(x => x.value));
                winner = lower.find(x => x.value === maxLowerVal);
            } else {
                // Tidak ada yang di bawah/tepat ‚Üí ambil yang paling dekat di atas
                const higher = all.filter(x => x.value > totalPrice);
                if (higher.length > 0) {
                    const minHigherVal = Math.min(...higher.map(x => x.value));
                    winner = higher.find(x => x.value === minHigherVal);
                }
            }

            const d1 = Math.abs(totalPrice - g1);
            const d2 = Math.abs(totalPrice - g2);
            const winnerText = winner ? `${winner.name} menang` : 'Tidak ada pemenang';

            const breakdown = `
                <div style="text-align:left;line-height:1.7">
                    <div><strong>Total Harga:</strong> Rp ${totalPrice.toLocaleString('id-ID')}</div>
                    <div><strong>Player 1:</strong> Rp ${g1.toLocaleString('id-ID')} (selisih ${d1.toLocaleString('id-ID')})</div>
                    <div><strong>Player 2:</strong> Rp ${g2.toLocaleString('id-ID')} (selisih ${d2.toLocaleString('id-ID')})</div>
                </div>
            `;

            Swal.fire({
                title: winnerText,
                html: breakdown,
                icon: 'success',
                showDenyButton: true,
                denyButtonText: 'Buat Sesi Baru',
                confirmButtonText: 'Tutup',
                confirmButtonColor: '#4CAF50',
                didOpen: () => {
                    setTimeout(() => { try { triggerConfetti(); } catch(e) {} }, 300);
                }
            }).then((res) => {
                if (res.isDenied) {
                    clearSession();
                }
            });
        }

        function showItemInput(item) {
            const availableParticipants = participantsData.filter(p => p !== null);
            
            if (availableParticipants.length === 0) {
                Swal.fire({
                    title: 'Belum Ada Partisipan',
                    text: 'Silakan tambahkan partisipan terlebih dahulu',
                    icon: 'info',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            // Buat HTML untuk daftar partisipan (checkbox)
            let participantOptions = '';
            availableParticipants.forEach((participant) => {
                const participantIndex = participantsData.indexOf(participant);
                const avatarUrl = `https://api.dicebear.com/9.x/notionists-neutral/svg?seed=${encodeURIComponent(participant.name)}`;
                participantOptions += `
                    <label class="participant-option" style="
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        padding: 12px;
                        margin-bottom: 8px;
                        border: 2px solid #e0e0e0;
                        border-radius: 12px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">
                        <input type="checkbox" class="swal-participant-checkbox" value="${participantIndex}" style="width:16px;height:16px;" />
                        <img src="${avatarUrl}" alt="${participant.name}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                        <div style="flex: 1;">
                            <div style="font-weight: bold; font-size: 14px; color: #333;">${participant.name}</div>
                        </div>
                    </label>
                `;
            });
            
            Swal.fire({
                title: item.name,
                html: `
                    <div style="margin-bottom: 20px;">
                        ${participantOptions}
                    </div>
                    <div style="width: 100%; margin-top: 20px; padding: 0 20px; box-sizing: border-box;">
                        <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333; font-size: 14px;">Tebak Harga (Rp)</label>
                        <input type="number" id="swal-item-price" class="swal2-input" placeholder="Masukkan tebakan harga" min="0" step="100" style="width: 100%; box-sizing: border-box; margin: 0;">
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Simpan',
                cancelButtonText: 'Batal',
                didOpen: () => {
                    // Highlight baris saat checkbox diubah
                    document.querySelectorAll('.swal-participant-checkbox').forEach(cb => {
                        cb.addEventListener('change', function() {
                            const row = this.closest('.participant-option');
                            if (this.checked) {
                                row.style.borderColor = '#4CAF50';
                                row.style.backgroundColor = '#f1f8f4';
                            } else {
                                row.style.borderColor = '#e0e0e0';
                                row.style.backgroundColor = 'transparent';
                            }
                        });
                    });
                },
                preConfirm: () => {
                    const priceGuess = document.getElementById('swal-item-price').value;
                    const checkedElements = Array.from(document.querySelectorAll('.swal-participant-checkbox:checked'));
                    const selectedIndices = checkedElements.map(el => parseInt(el.value));
                    if (selectedIndices.length === 0) {
                        Swal.showValidationMessage('Pilih minimal satu partisipan!');
                        return false;
                    }
                    
                    if (!priceGuess || priceGuess <= 0) {
                        Swal.showValidationMessage('Harap masukkan tebakan harga yang valid!');
                        return false;
                    }
                    
                    // Validasi limit tanpa auto-replace: makanan max 2, minuman max 1
                    const menuItem = menuItems.find(m => m.id === item.id);
                    const isFood = menuItem && menuItem.type === 'makanan';
                    const isDrink = menuItem && menuItem.type === 'minuman';
                    for (const pIndex of selectedIndices) {
                        const participant = participantsData[pIndex];
                        if (!participant) continue;
                        const items = participant.items || [];
                        const alreadyHasItem = items.some(i => i.itemId === item.id);
                        const typeCount = items.filter(i => {
                            const mi = menuItems.find(m => m.id === i.itemId);
                            return mi && mi.type === (isFood ? 'makanan' : 'minuman');
                        }).length;
                        if (!alreadyHasItem) {
                            if (isFood && typeCount >= 2) {
                                Swal.showValidationMessage(`${participant.name} sudah memilih 2 makanan. Uncheck salah satu dulu.`);
                                return false;
                            }
                            if (isDrink && typeCount >= 1) {
                                Swal.showValidationMessage(`${participant.name} sudah memilih 1 minuman. Uncheck salah satu dulu.`);
                                return false;
                            }
                        }
                    }
                    
                    return {
                        participantIndices: selectedIndices,
                        quantity: 1, // Setiap item selalu quantity 1
                        priceGuess: parseInt(priceGuess)
                    };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const { participantIndices, quantity, priceGuess } = result.value;
                    participantIndices.forEach((participantIndex) => {
                        const participant = participantsData[participantIndex];
                        if (!participant.items) {
                            participant.items = [];
                        }
                        // Cek apakah item sudah ada ‚Üí update
                        const existingItemIndex = participant.items.findIndex(i => i.itemId === item.id);
                        if (existingItemIndex !== -1) {
                            participant.items[existingItemIndex].quantity = quantity;
                            participant.items[existingItemIndex].priceGuess = priceGuess;
                        } else {
                            participant.items.push({
                                itemId: item.id,
                                itemName: item.name,
                                quantity: quantity,
                                price: item.price,
                                priceGuess: priceGuess
                            });
                        }
                        // Update total per partisipan
                        participant.total = participant.items.reduce((sum, it) => {
                            const menuItem = menuItems.find(m => m.id === it.itemId);
                            return sum + (menuItem ? menuItem.price * it.quantity : 0);
                        }, 0);
                    });
                    saveParticipants();
                    updateParticipantDisplay();
                    // Sinkronkan highlight item terpilih
                    updateSelectedVisuals();
                    // Cek auto tampilkan hasil
                    maybeAutoShowResults();
                } else {
                    // Jika batal/tutup, sinkronkan highlight sesuai data
                    updateSelectedVisuals();
                }
            });
        }

        function applyRandomRotation() {
            $('.food-item').each(function() {
                const randomAngle = (Math.random() * 10 - 5).toFixed(2);
                $(this).css('--hover-rotate', `${randomAngle}deg`);
            });
        }

        function loadQuestions() {
            questions = JSON.parse(localStorage.getItem('quizQuestions')) || [];
            
            // Load participants and answers from answer.html data
            const savedParticipants = localStorage.getItem('quizParticipants');
            if (savedParticipants) {
                participants = JSON.parse(savedParticipants);
            }

            const savedAnswers = localStorage.getItem('quizAnswers');
            if (savedAnswers) {
                answers = JSON.parse(savedAnswers);
            }
            
            if (questions.length === 0) {
                $('#noQuestionsMessage').removeClass('hidden');
                return;
            }
            
            showCurrentQuestion();
        }

        function initializeEventListeners() {
            // Navigation buttons
            $('#nextBtn').on('click', function() {
                if (currentQuestionIndex === questions.length - 1) {
                    showResults();
                } else {
                    nextQuestion();
                }
            });

            $('#prevBtn').on('click', function() {
                previousQuestion();
            });

            // Keyboard shortcuts
            $(document).on('keydown', function(e) {
                if (e.key === 'ArrowLeft' && !$('#prevBtn').prop('disabled')) {
                    previousQuestion();
                } else if (e.key === 'ArrowRight' && !$('#nextBtn').prop('disabled')) {
                    if (currentQuestionIndex === questions.length - 1) {
                        showResults();
                    } else {
                        nextQuestion();
                    }
                }
            });

            // Back to quiz button
            $('#backToQuiz').on('click', function() {
                backToQuiz();
            });
            
            // View Results button
            $('#viewResultsBtn').on('click', function() {
                showPriceGuessResults();
            });
            // Quick Results button (top-left)
            $('#quickResultsBtn').on('click', function() {
                // Jika belum ada guesses, tampilkan form input
                let guesses = null;
                try {
                    const s = localStorage.getItem('priceGuesses');
                    if (s) guesses = JSON.parse(s);
                } catch (e) {}
                const foodCount = selectedItems.filter(mi => mi.type === 'makanan').length;
                const drinkCount = selectedItems.filter(mi => mi.type === 'minuman').length;
                if (foodCount !== 2 || drinkCount !== 1) return;
                if (!guesses || typeof guesses.player1 !== 'number' || typeof guesses.player2 !== 'number') {
                    Swal.fire({
                        title: 'Masukkan Tebakan Harga',
                        html: `
                            <div style="text-align:left;">
                                <div style=\"margin-bottom:10px; font-weight:600;\">Player 1</div>
                                <input type=\"number\" id=\"guess-player-1\" class=\"swal2-input\" placeholder=\"Tebak harga Player 1\" min=\"0\" step=\"100\" style=\"width:100%; box-sizing:border-box; margin:0;\">
                                <div style=\"margin:14px 0 10px; font-weight:600;\">Player 2</div>
                                <input type=\"number\" id=\"guess-player-2\" class=\"swal2-input\" placeholder=\"Tebak harga Player 2\" min=\"0\" step=\"100\" style=\"width:100%; box-sizing:border-box; margin:0;\">
                            </div>
                        `,
                        focusConfirm: false,
                        showCancelButton: true,
                        cancelButtonText: 'Batal',
                        confirmButtonText: 'Lihat Hasil',
                        confirmButtonColor: '#4CAF50',
                        preConfirm: () => {
                            const p1 = parseInt(document.getElementById('guess-player-1').value, 10);
                            const p2 = parseInt(document.getElementById('guess-player-2').value, 10);
                            if (isNaN(p1) || p1 < 0) { Swal.showValidationMessage('Masukkan tebakan harga Player 1 yang valid'); return false; }
                            if (isNaN(p2) || p2 < 0) { Swal.showValidationMessage('Masukkan tebakan harga Player 2 yang valid'); return false; }
                            try { localStorage.setItem('priceGuesses', JSON.stringify({ player1: p1, player2: p2 })); } catch(e) {}
                            return { p1, p2 };
                        }
                    }).then((res) => {
                        if (res.isConfirmed) { showPriceGuessResults(); }
                    });
                } else {
                    showPriceGuessResults();
                }
            });
            
            // New Session button
            $('#newSessionBtn').on('click', function() {
                clearSession();
            });

        }

        function showAllResults() {
            const availableParticipants = participantsData.filter(p => p !== null);
            
            if (availableParticipants.length === 0) {
                Swal.fire({
                    title: 'Belum Ada Partisipan',
                    text: 'Silakan tambahkan partisipan terlebih dahulu',
                    icon: 'info',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            if (availableParticipants.length === 0) {
                Swal.fire({
                    title: 'Belum Ada Partisipan',
                    text: 'Silakan tambahkan partisipan terlebih dahulu',
                    icon: 'info',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            // Validasi: setiap partisipan harus memilih 2 makanan dan 1 minuman
            const incompleteParticipants = [];
            availableParticipants.forEach((participant, index) => {
                const foodItems = participant.items ? participant.items.filter(item => {
                    const menuItem = menuItems.find(m => m.id === item.itemId);
                    return menuItem && menuItem.type === 'makanan';
                }) : [];
                const drinkItems = participant.items ? participant.items.filter(item => {
                    const menuItem = menuItems.find(m => m.id === item.itemId);
                    return menuItem && menuItem.type === 'minuman';
                }) : [];
                
                if (foodItems.length !== 2 || drinkItems.length !== 1) {
                    incompleteParticipants.push({
                        name: participant.name,
                        foodCount: foodItems.length,
                        drinkCount: drinkItems.length
                    });
                }
            });
            
            // Jika ada partisipan yang belum lengkap, tampilkan alert
            if (incompleteParticipants.length > 0) {
                let messageHTML = '<div style="text-align: left; padding: 10px;">';
                messageHTML += '<p style="margin-bottom: 15px; font-weight: bold;">Beberapa partisipan belum memilih item lengkap:</p>';
                messageHTML += '<ul style="margin-left: 20px; margin-bottom: 15px;">';
                incompleteParticipants.forEach(p => {
                    messageHTML += `<li style="margin-bottom: 8px;">`;
                    messageHTML += `<strong>${p.name}</strong>: `;
                    messageHTML += `<span style="color: ${p.foodCount === 2 ? '#4CAF50' : '#d32f2f'}; font-weight: bold;">Makanan ${p.foodCount}/2</span>, `;
                    messageHTML += `<span style="color: ${p.drinkCount === 1 ? '#4CAF50' : '#d32f2f'}; font-weight: bold;">Minuman ${p.drinkCount}/1</span>`;
                    messageHTML += `</li>`;
                });
                messageHTML += '</ul>';
                messageHTML += '<p style="margin-top: 15px; color: #666; font-style: italic;">Setiap partisipan harus memilih tepat 2 makanan dan 1 minuman.</p>';
                messageHTML += '</div>';
                
                Swal.fire({
                    title: '‚ö†Ô∏è Data Belum Lengkap',
                    html: messageHTML,
                    icon: 'warning',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#FFA500',
                    width: '500px'
                });
                return;
            }
            
            // Hitung poin untuk setiap partisipan berdasarkan perbandingan per posisi item
            const participantScores = availableParticipants.map((participant, pIndex) => {
                let points = 0;
                let foodPoints = 0;
                let drinkPoints = 0;
                
                return {
                    participant: participant,
                    points: points,
                    foodCount: foodPoints,
                    drinkCount: drinkPoints
                };
            });
            
            // Tentukan jumlah item maksimal yang harus dibandingkan (3 item: 2 makanan + 1 minuman)
            const maxItemsToCompare = 3;
            
            // Bandingkan per posisi item (item ke-1 vs item ke-1, item ke-2 vs item ke-2, dst)
            for (let itemPosition = 0; itemPosition < maxItemsToCompare; itemPosition++) {
                const comparisons = [];
                
                // Kumpulkan item pada posisi ini dari setiap partisipan
                availableParticipants.forEach((participant, pIndex) => {
                    if (participant.items && participant.items[itemPosition]) {
                        const item = participant.items[itemPosition];
                        const menuItem = menuItems.find(m => m.id === item.itemId);
                        
                        if (menuItem && item.priceGuess !== undefined && item.priceGuess !== null && !isNaN(item.priceGuess)) {
                            const guess = parseInt(item.priceGuess);
                            const correctPrice = menuItem.price;
                            const difference = Math.abs(guess - correctPrice);
                            
                            comparisons.push({
                                participantIndex: pIndex,
                                itemId: item.itemId,
                                guess: guess,
                                correctPrice: correctPrice,
                                difference: difference,
                                itemType: menuItem.type
                            });
                        }
                    }
                });
                
                // Jika ada minimal 2 partisipan yang punya item di posisi ini, tentukan pemenang
                if (comparisons.length >= 2) {
                    // Cari selisih terkecil
                    const minDifference = Math.min(...comparisons.map(c => c.difference));
                    const winners = comparisons.filter(c => c.difference === minDifference);
                    
                    // Berikan poin ke pemenang (jika ada tie, semua yang tie dapat poin)
                    winners.forEach(winner => {
                        participantScores[winner.participantIndex].points++;
                        if (winner.itemType === 'makanan') {
                            participantScores[winner.participantIndex].foodCount++;
                        } else if (winner.itemType === 'minuman') {
                            participantScores[winner.participantIndex].drinkCount++;
                        }
                    });
                } else if (comparisons.length === 1) {
                    // Jika hanya 1 partisipan yang punya item di posisi ini, dia otomatis menang
                    const winner = comparisons[0];
                    participantScores[winner.participantIndex].points++;
                    if (winner.itemType === 'makanan') {
                        participantScores[winner.participantIndex].foodCount++;
                    } else if (winner.itemType === 'minuman') {
                        participantScores[winner.participantIndex].drinkCount++;
                    }
                }
            }
            
            // Sort berdasarkan poin tertinggi
            participantScores.sort((a, b) => b.points - a.points);
            
            // Tentukan pemenang (yang poinnya tertinggi)
            const maxPoints = participantScores.length > 0 ? participantScores[0].points : 0;
            const winners = participantScores.filter(p => p.points === maxPoints);
            
            let resultsHTML = '';
            
            // Trigger confetti jika ada pemenang dengan poin > 0
            const shouldTriggerConfetti = maxPoints > 0;
            
            // Tampilkan pemenang terlebih dahulu
            if (winners.length > 0 && maxPoints > 0) {
                resultsHTML += `
                    <div style="
                        background: #FFD700;
                        border-radius: 20px;
                        padding: 25px;
                        margin-bottom: 25px;
                        box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4);
                        color: white;
                        border: 3px solid #FFD700;
                    ">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 48px; margin-bottom: 10px;">üèÜ</div>
                            <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">PEMENANG</div>
                            <div style="font-size: 32px; font-weight: bold;">${winners.map(w => w.participant.name).join(', ')}</div>
                            <div style="font-size: 20px; margin-top: 10px; opacity: 0.9;">${maxPoints} Poin</div>
                        </div>
                    </div>
                `;
            }
            
            // Tampilkan semua partisipan dengan ranking
            participantScores.forEach((scoreData, index) => {
                const participant = scoreData.participant;
                const avatarUrl = `https://api.dicebear.com/9.x/notionists-neutral/svg?seed=${encodeURIComponent(participant.name)}`;
                const foodItems = participant.items ? participant.items.filter(item => {
                    const menuItem = menuItems.find(m => m.id === item.itemId);
                    return menuItem && menuItem.type === 'makanan';
                }) : [];
                const drinkItems = participant.items ? participant.items.filter(item => {
                    const menuItem = menuItems.find(m => m.id === item.itemId);
                    return menuItem && menuItem.type === 'minuman';
                }) : [];
                
                const rank = index + 1;
                // Hanya juara 1 yang dianggap sebagai pemenang (background hijau)
                const isWinner = rank === 1 && maxPoints > 0;
                let rankIcon = '';
                
                if (rank === 1 && maxPoints > 0) {
                    rankIcon = 'ü•á';
                } else if (rank === 2 && participantScores.length >= 2) {
                    rankIcon = 'ü•à';
                } else if (rank === 3 && participantScores.length >= 3) {
                    rankIcon = 'ü•â';
                }
                
                resultsHTML += `
                    <div style="
                        background: ${isWinner ? '#4CAF50' : 'white'};
                        border-radius: 20px;
                        padding: 20px;
                        margin-bottom: 20px;
                        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
                        color: ${isWinner ? 'white' : '#333'};
                        transition: transform 0.3s ease;
                        ${isWinner ? 'border: 3px solid #FFD700;' : ''}
                    ">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="
                                width: 70px;
                                height: 70px;
                                border-radius: 50%;
                                border: 4px solid ${isWinner ? '#FFD700' : '#e0e0e0'};
                                overflow: hidden;
                                background: ${isWinner ? 'rgba(255, 255, 255, 0.3)' : '#f5f5f5'};
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            ">
                                <img src="${avatarUrl}" alt="${participant.name}" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                                    ${rankIcon ? `<span style="font-size: 24px;">${rankIcon}</span>` : ''}
                                    <div style="font-weight: bold; font-size: 20px; color: ${isWinner ? 'white' : '#333'};">
                                        ${participant.name}
                                    </div>
                                </div>
                                <div style="
                                    background: ${isWinner ? 'rgba(255, 255, 255, 0.3)' : '#f0f0f0'};
                                    padding: 8px 15px;
                                    border-radius: 20px;
                                    display: inline-block;
                                    font-size: 16px;
                                    font-weight: bold;
                                    color: ${isWinner ? 'white' : '#333'};
                                ">
                                    ${scoreData.points} Poin
                                </div>
                            </div>
                        </div>
                        <div style="
                            background: ${isWinner ? 'rgba(255, 255, 255, 0.2)' : '#f9f9f9'};
                            border-radius: 15px;
                            padding: 15px;
                        ">
                            ${foodItems.length > 0 ? `
                                <div style="margin-bottom: 10px;">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                        <span style="font-size: 18px;"></span>
                                        <span style="font-weight: bold; font-size: 14px; color: ${isWinner ? 'white' : '#333'};">Makanan:</span>
                                        <span style="font-size: 14px; color: ${isWinner ? 'rgba(255, 255, 255, 0.9)' : '#666'};">(${scoreData.foodCount} poin)</span>
                                    </div>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-left: 26px;">
                                        ${foodItems.map(item => {
                                            const menuItem = menuItems.find(m => m.id === item.itemId);
                                            const correctPrice = menuItem ? menuItem.price : 0;
                                            const priceGuess = item.priceGuess || 0;
                                            return `
                                                <span style="
                                                    background: ${isWinner ? 'rgba(255, 255, 255, 0.3)' : '#e8e8e8'};
                                                    padding: 6px 12px;
                                                    border-radius: 15px;
                                                    font-size: 12px;
                                                    font-weight: 500;
                                                    color: ${isWinner ? 'white' : '#333'};
                                                ">
                                                    ${menuItem ? menuItem.name : item.itemName} √ó ${item.quantity}<br>
                                                    <small style="font-size: 10px; opacity: ${isWinner ? '0.9' : '1'};">Tebak: Rp ${priceGuess.toLocaleString('id-ID')} | Benar: Rp ${correctPrice.toLocaleString('id-ID')}</small>
                                                </span>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            ${drinkItems.length > 0 ? `
                                <div>
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                        <span style="font-size: 18px;"></span>
                                        <span style="font-weight: bold; font-size: 14px; color: ${isWinner ? 'white' : '#333'};">Minuman:</span>
                                        <span style="font-size: 14px; color: ${isWinner ? 'rgba(255, 255, 255, 0.9)' : '#666'};">(${scoreData.drinkCount} poin)</span>
                                    </div>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-left: 26px;">
                                        ${drinkItems.map(item => {
                                            const menuItem = menuItems.find(m => m.id === item.itemId);
                                            const correctPrice = menuItem ? menuItem.price : 0;
                                            const priceGuess = item.priceGuess || 0;
                                            return `
                                                <span style="
                                                    background: ${isWinner ? 'rgba(255, 255, 255, 0.3)' : '#e8e8e8'};
                                                    padding: 6px 12px;
                                                    border-radius: 15px;
                                                    font-size: 12px;
                                                    font-weight: 500;
                                                    color: ${isWinner ? 'white' : '#333'};
                                                ">
                                                    ${menuItem ? menuItem.name : item.itemName} √ó ${item.quantity}<br>
                                                    <small style="font-size: 10px; opacity: ${isWinner ? '0.9' : '1'};">Tebak: Rp ${priceGuess.toLocaleString('id-ID')} | Benar: Rp ${correctPrice.toLocaleString('id-ID')}</small>
                                                </span>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            ${(foodItems.length === 0 && drinkItems.length === 0) ? `
                                <div style="
                                    text-align: center;
                                    padding: 20px;
                                    font-size: 14px;
                                    opacity: 0.8;
                                    font-style: italic;
                                ">
                                    Belum memilih item
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            });
            
            Swal.fire({
                title: '',
                html: `
                    <div style="max-height: 65vh; overflow-y: auto; padding: 10px;">
                        ${resultsHTML}
                    </div>
                `,
                width: '650px',
                confirmButtonText: 'Tutup',
                confirmButtonColor: '#4CAF50',
                showCancelButton: false,
                customClass: {
                    popup: 'results-popup'
                },
                didOpen: () => {
                    // Trigger confetti setelah popup terbuka
                    if (shouldTriggerConfetti) {
                        // Delay untuk memastikan popup sudah fully rendered
                        setTimeout(() => {
                            triggerConfetti();
                        }, 1000);
                    }
                },
                willClose: () => {
                    // Pastikan confetti masih berjalan meski popup ditutup
                    if (shouldTriggerConfetti) {
                        // Trigger lagi saat akan menutup untuk efek lebih dramatis
                        setTimeout(() => {
                            triggerConfetti();
                        }, 100);
                    }
                }
            });
        }

        function showCurrentQuestion() {
            const question = questions[currentQuestionIndex];
            
            $('#questionText').text(question.question);
            $('#questionNumber').text(currentQuestionIndex + 1);
            $('#totalQuestions').text(questions.length);
            
            updateProgress();
            updateNavigationButtons();
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            $('#progressBar').css('width', progress + '%');
            $('#progressText').text(`${currentQuestionIndex + 1} / ${questions.length}`);
        }

        function updateNavigationButtons() {
            $('#prevBtn').prop('disabled', currentQuestionIndex === 0);
            
            if (currentQuestionIndex === questions.length - 1) {
                $('#nextBtnText').text('Lihat Hasil');

                $('#nextBtn').removeClass('bg-rose-600 hover:bg-rose-700 focus:ring-rose-300');
                $('#nextBtn').addClass('bg-green-600 hover:bg-green-700 focus:ring-green-300');
            } else {
                $('#nextBtnText').text('Selanjutnya');
                $('#nextBtnIcon').text('‚Üí');
                $('#nextBtn').removeClass('bg-green-600 hover:bg-green-700 focus:ring-green-300');
                $('#nextBtn').addClass('bg-rose-600 hover:bg-rose-700 focus:ring-rose-300');
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showCurrentQuestion();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showCurrentQuestion();
            }
        }

        function showResults() {
            // Hide quiz elements
            $('#progressBar').parent().parent().addClass('hidden');
            $('.bg-cyan-50').addClass('hidden');
            $('.flex.justify-between.items-center').addClass('hidden');
            
            // Show results
            $('#resultsSection').removeClass('hidden');
            
            // Calculate and display all results
            displayAllResults();
        }

        function displayAllResults() {
            const results = calculateResults();
            const $resultsBody = $('#resultsTableBody');
            
            $resultsBody.empty();
            
            if (results.length === 0) {
                $resultsBody.append(`
                    <tr>
                        <td colspan="3" class="border border-gray-300 px-6 py-8 text-center text-gray-500 text-lg">
                            Belum ada data peserta atau jawaban
                        </td>
                    </tr>
                `);
                return;
            }
            
            // Sort results by percentage (highest first)
            results.sort((a, b) => b.percentage - a.percentage);
            
            // Set winner announcement
            if (results.length > 0) {
                const winner = results[0];
                $('#winnerName').text(winner.name);
                $('#winnerScore').text(`${winner.correct}/${winner.total}`);
                
                // Trigger confetti for winner
                setTimeout(() => {
                    triggerConfetti();
                }, 500);
            }
            
            results.forEach((result, index) => {
                let percentageColor = '';
                let rowClass = '';
                
                if (result.percentage >= 80) {
                    percentageColor = 'text-green-600';
                    rowClass = 'bg-gradient-to-r from-green-50 to-emerald-50';
                } else if (result.percentage >= 60) {
                    percentageColor = 'text-yellow-600';
                    rowClass = 'bg-gradient-to-r from-yellow-50 to-orange-50';
                } else {
                    percentageColor = 'text-red-600';
                    rowClass = 'bg-gradient-to-r from-red-50 to-pink-50';
                }
                
                const rank = index + 1;
                let rankIcon = '';
                let rankClass = '';
                
                if (rank === 1) {
                    rankIcon = 'ü•á';
                    rankClass = 'font-black text-yellow-600 text-2xl';
                } else if (rank === 2) {
                    rankIcon = 'ü•à';
                    rankClass = 'font-bold text-gray-500 text-xl';
                } else if (rank === 3) {
                    rankIcon = 'ü•â';
                    rankClass = 'font-bold text-orange-600 text-xl';
                } else {
                    rankIcon = 'üèÖ';
                    rankClass = 'font-semibold text-gray-600 text-lg';
                }
                
                $resultsBody.append(`
                    <tr class="${rowClass} hover:shadow-lg transition-all duration-300 transform hover:scale-105">
                        <td class="border border-gray-300 px-8 py-6 text-center ${rankClass}">
                            ${rankIcon}
                        </td>
                        <td class="border border-gray-300 px-8 py-6 font-bold text-xl text-gray-800">
                            ${result.name}
                        </td>
                        <td class="border border-gray-300 px-8 py-6 text-center font-bold text-2xl text-gray-700">
                            ${result.correct} / ${result.total}
                        </td>
                    </tr>
                `);
            });
            
            // Add celebrate button event listener
            $('#celebrateBtn').off('click').on('click', function() {
                triggerConfetti();
                playCelebrationSound();
            });
        }

        function backToQuiz() {
            // Show quiz elements
            $('#progressBar').parent().parent().removeClass('hidden');
            $('.bg-cyan-50').removeClass('hidden');
            $('.flex.justify-between.items-center').removeClass('hidden');
            
            // Hide results
            $('#resultsSection').addClass('hidden');
        }

        function calculateResults() {
            if (participants.length === 0) {
                return [];
            }

            const results = [];

            participants.forEach((participant, pIndex) => {
                let correct = 0;
                
                questions.forEach((question, qIndex) => {
                    const userAnswer = answers[pIndex] && answers[pIndex][qIndex] !== undefined 
                        ? answers[pIndex][qIndex] 
                        : null;
                    
                    if (userAnswer !== null && isAnswerCorrect(question, userAnswer, qIndex, pIndex)) {
                        correct++;
                    }
                });

                const percentage = Math.round((correct / questions.length) * 100);
                results.push({
                    name: participant,
                    correct: correct,
                    total: questions.length,
                    percentage: percentage
                });
            });

            return results;
        }

        function isAnswerCorrect(question, userAnswer, questionIndex, participantIndex) {
            const correctAnswer = question.answer;
            
            // Kumpulkan semua jawaban dari partisipan untuk pertanyaan ini
            const allAnswersForQuestion = [];
            participants.forEach((p, pIndex) => {
                if (pIndex !== participantIndex && answers[pIndex] && answers[pIndex][questionIndex] !== undefined) {
                    allAnswersForQuestion.push(answers[pIndex][questionIndex]);
                }
            });

            // Algoritma penilaian
            const lowerAnswers = allAnswersForQuestion.filter(answer => answer < correctAnswer);
            
            if (lowerAnswers.length > 0) {
                const maxLowerAnswer = Math.max(...lowerAnswers);
                return userAnswer === maxLowerAnswer;
            } else {
                const higherAnswers = allAnswersForQuestion.filter(answer => answer > correctAnswer);
                if (higherAnswers.length > 0) {
                    const minHigherAnswer = Math.min(...higherAnswers);
                    return userAnswer === minHigherAnswer;
                } else {
                    return userAnswer === correctAnswer;
                }
            }
        }

        // Confetti effect function
        function triggerConfetti() {
            // Pastikan library confetti tersedia
            if (typeof confetti === 'undefined') {
                console.error('Confetti library not loaded');
                return;
            }
            
            // Set z-index tinggi untuk semua canvas confetti yang dibuat
            setTimeout(() => {
                const confettiCanvases = document.querySelectorAll('canvas[id^="confetti"]');
                confettiCanvases.forEach(canvas => {
                    canvas.style.zIndex = '999999';
                    canvas.style.pointerEvents = 'none';
                });
            }, 100);
            
            // Multiple confetti bursts dari tengah
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    confetti({
                        particleCount: 150,
                        spread: 90,
                        origin: { y: 0.6, x: 0.5 },
                        colors: ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff', '#FFD700']
                    });
                    
                    // Set z-index setelah confetti dibuat
                    setTimeout(() => {
                        const canvases = document.querySelectorAll('canvas');
                        canvases.forEach(canvas => {
                            if (canvas.style.position === 'fixed' || canvas.style.position === '') {
                                canvas.style.zIndex = '999999';
                                canvas.style.pointerEvents = 'none';
                            }
                        });
                    }, 50);
                }, i * 150);
            }
            
            // Burst dari kiri
            setTimeout(() => {
                confetti({
                    particleCount: 80,
                    angle: 60,
                    spread: 70,
                    origin: { x: 0, y: 0.5 },
                    colors: ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#FFD700']
                });
            }, 400);
            
            // Burst dari kanan
            setTimeout(() => {
                confetti({
                    particleCount: 80,
                    angle: 120,
                    spread: 70,
                    origin: { x: 1, y: 0.5 },
                    colors: ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#FFD700']
                });
            }, 600);
            
            // Burst dari atas
            setTimeout(() => {
                confetti({
                    particleCount: 100,
                    angle: 90,
                    spread: 80,
                    origin: { x: 0.5, y: 0 },
                    colors: ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#FFD700']
                });
            }, 800);
        }

        // Celebration sound effect (using Web Audio API)
        function playCelebrationSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Create a simple celebration sound
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Create a rising melody
                const frequencies = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
                
                frequencies.forEach((freq, index) => {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    
                    osc.frequency.setValueAtTime(freq, audioContext.currentTime);
                    osc.type = 'sine';
                    
                    gain.gain.setValueAtTime(0, audioContext.currentTime);
                    gain.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.1);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    osc.start(audioContext.currentTime + index * 0.1);
                    osc.stop(audioContext.currentTime + index * 0.1 + 0.5);
                });
            } catch (error) {
                console.log('Audio not supported or blocked');
            }
        }
    </script>
</body>
</html>
