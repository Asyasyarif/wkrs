<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis Interaktif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 5px rgba(59, 130, 246, 0.5);
            }
            50% {
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.8), 0 0 30px rgba(59, 130, 246, 0.6);
            }
        }
        
        .bounce-animation {
            animation: bounce 1s infinite;
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        .slide-in {
            animation: slideIn 0.6s ease-out;
        }
        
        .glow-effect {
            animation: glow 2s infinite;
        }
        
        .progress-bar-animated {
            background: linear-gradient(90deg, #ec4899, #8b5cf6, #06b6d4, #10b981);
            background-size: 200% 100%;
            animation: gradient 3s ease infinite;
        }
        
        @keyframes gradient {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        
        .celebration-bg {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57);
            background-size: 400% 400%;
            animation: gradientShift 4s ease infinite;
        }
        
        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        
        .winner-crown {
            position: relative;
        }
        
        .winner-crown::before {
            content: "👑";
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2rem;
            animation: bounce 1s infinite;
        }
        
        .food-item {
            transition: all 0.3s ease;
            cursor: pointer;
            width: 100%;
            height: 120px;
            overflow: visible;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .food-item:hover {
            z-index: 10;
        }
        
        .food-item img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            transition: all 0.3s ease;
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, .5));
        }
        
        .food-item:hover img {
            transform: scale(1.15) rotate(var(--hover-rotate, 0deg));
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.9))
                    drop-shadow(0 0 40px rgba(255, 255, 255, 0.7))
                    drop-shadow(0 0 60px rgba(255, 255, 255, 0.5));
        }
        
        #newSessionBtn:hover {
            background-color: #B85A15;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        #newSessionBtn:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        .participant-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }
        
        .participant-card.has-placeholder {
            background-color: transparent !important;
            border: 2px dashed rgba(255, 255, 255, 0.5);
            box-shadow: none;
            padding: 0;
            width: 72px !important;
            min-width: 72px !important;
            border-radius: 50% !important;
            justify-content: center;
        }
        
        .participant-card.has-placeholder:hover {
            border-color: rgba(255, 255, 255, 0.8);
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .participant-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .participant-placeholder div {
            padding: 4px;
        }
        
        .participant-info {
            display: none;
        }
        
        .participant-info.show {
            display: flex !important;
        }
        
        #participantModal {
            display: none;
        }
        
        #participantModal.show {
            display: flex !important;
        }
        
        #closeModalBtn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .clear-participant-btn:hover {
            background: rgba(255, 0, 0, 0.2);
            border-color: rgba(255, 0, 0, 0.5);
            transform: scale(1.1);
        }
        
        .clear-participant-btn:active {
            transform: scale(0.95);
        }
        
        .participant-option:hover {
            border-color: #4CAF50 !important;
            background-color: #f9f9f9 !important;
        }
        
        #swal-item-quantity {
            width: 100% !important;
            box-sizing: border-box !important;
            margin: 0 !important;
        }
        
        .swal2-html-container {
            border-radius: 50px !important;
            padding: 1 !important;
        }
        
        #viewResultsBtn:hover {
            background-color: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        #viewResultsBtn:active {
            transform: translateY(0);
        }
        
        .results-popup {
            border-radius: 25px !important;
        }
        
        /* Pastikan canvas confetti muncul di atas SweetAlert */
        canvas {
            z-index: 999999 !important;
            pointer-events: none !important;
        }
        
        .swal2-container {
            z-index: 1060 !important;
        }
    </style>
</head>
<body style="margin: 0; padding: 0; overflow: hidden; height: 100vh; background-color: #311E0C;">
    <div style="
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        width: 100vw;
        position: relative;
    ">
        <!-- Info Partisipan -->
        <div style="
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 9px;
        ">
            <div class="participant-card" data-participant="0" style="
                min-width: 72px;
                height: 72px;
                background-color: rgba(255, 255, 255, 0.95);
                border-radius: 36px;
                display: flex;
                flex-direction: row;
                align-items: center;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
                cursor: pointer;
                transition: all 0.3s ease;
                overflow: hidden;
            ">
                <div id="participant-placeholder-0" class="participant-placeholder" style="width: 72px; height: 72px;">
                    <div style="font-size: 29px; font-weight: bold; color: #666;">+</div>
                </div>
                <div id="participant-info-0" class="participant-info" style="flex: 1; flex-direction: row; align-items: center; justify-content: space-between; height: 100%;">
                    <div style="display: flex; flex-direction: row; align-items: center; flex: 1;">
                        <img id="participant-avatar-0" src="" alt="Avatar" style="width: 72px; height: 72px; border-radius: 50%; object-fit: cover; flex-shrink: 0;">
                        <div style="padding: 8px 12px; flex: 1;">
                            <div id="participant-name-0" style="font-weight: bold; font-size: 11px; margin-bottom: 4px; color: #333;"></div>
                            <div id="participant-food-0" style="font-size: 8px; color: #666; margin-bottom: 2px;">
                                Makanan <span id="participant-food-count-0">0</span>/<span id="participant-food-total-0">2</span>
                            </div>
                            <div id="participant-drink-0" style="font-size: 8px; color: #666;">
                                Minuman <span id="participant-drink-count-0">0</span>/<span id="participant-drink-total-0">1</span>
                            </div>
                        </div>
                    </div>
                    <button class="clear-participant-btn" data-participant="0" style="
                        background: rgba(255, 0, 0, 0.1);
                        border: 1px solid rgba(255, 0, 0, 0.3);
                        color: #d32f2f;
                        width: 24px;
                        height: 24px;
                        border-radius: 50%;
                        font-size: 12px;
                        cursor: pointer;
                        margin-right: 9px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        transition: all 0.3s ease;
                        flex-shrink: 0;
                    ">×</button>
                </div>
            </div>
            
            <div class="participant-card" data-participant="1" style="
                min-width: 72px;
                height: 72px;
                background-color: rgba(255, 255, 255, 0.95);
                border-radius: 36px;
                display: flex;
                flex-direction: row;
                align-items: center;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
                cursor: pointer;
                transition: all 0.3s ease;
                overflow: hidden;
            ">
                <div id="participant-placeholder-1" class="participant-placeholder" style="width: 72px; height: 72px;">
                    <div style="font-size: 29px; font-weight: bold; color: #666;">+</div>
                </div>
                <div id="participant-info-1" class="participant-info" style="flex: 1; flex-direction: row; align-items: center; justify-content: space-between; height: 100%;">
                    <div style="display: flex; flex-direction: row; align-items: center; flex: 1;">
                        <img id="participant-avatar-1" src="" alt="Avatar" style="width: 72px; height: 72px; border-radius: 50%; object-fit: cover; flex-shrink: 0;">
                        <div style="padding: 8px 12px; flex: 1;">
                            <div id="participant-name-1" style="font-weight: bold; font-size: 11px; margin-bottom: 4px; color: #333;"></div>
                            <div id="participant-food-1" style="font-size: 8px; color: #666; margin-bottom: 2px;">
                                Makanan <span id="participant-food-count-1">0</span>/<span id="participant-food-total-1">2</span>
                            </div>
                            <div id="participant-drink-1" style="font-size: 8px; color: #666;">
                                Minuman <span id="participant-drink-count-1">0</span>/<span id="participant-drink-total-1">1</span>
                            </div>
                        </div>
                    </div>
                    <button class="clear-participant-btn" data-participant="1" style="
                        background: rgba(255, 0, 0, 0.1);
                        border: 1px solid rgba(255, 0, 0, 0.3);
                        color: #d32f2f;
                        width: 24px;
                        height: 24px;
                        border-radius: 50%;
                        font-size: 12px;
                        cursor: pointer;
                        margin-right: 9px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        transition: all 0.3s ease;
                        flex-shrink: 0;
                    ">×</button>
                </div>
            </div>
            
            <!-- Tombol Lihat Hasil -->
            <button id="viewResultsBtn" style="
                width: 100%;
                background-color: #4CAF50;
                color: white;
                padding: 10px 20px;
                border: none;
                border-radius: 20px;
                font-size: 14px;
                font-weight: bold;
                cursor: pointer;
                margin-top: 15px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
                transition: all 0.3s ease;
            ">
                Lihat Hasil
            </button>
        </div>

        <!-- Modal Avatar Full Screen -->
        <div id="participantModal" style="
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        ">
            <div style="
                display: flex;
                align-items: center;
                gap: 60px;
                padding: 40px;
                max-width: 90%;
            ">
                <div style="
                    flex-shrink: 0;
                ">
                    <img id="modal-avatar" src="" alt="Avatar" style="
                        width: 400px;
                        height: 400px;
                        border-radius: 50%;
                        object-fit: cover;
                        border: 6px solid white;
                        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
                    ">
                </div>
                <div style="
                    flex: 1;
                    color: white;
                ">
                    <h2 id="modal-name" style="
                        font-size: 48px;
                        font-weight: bold;
                        margin-bottom: 40px;
                        color: white;
                    "></h2>
                    <div style="
                        font-size: 32px;
                        line-height: 1.8;
                    ">
                        <div id="modal-food" style="margin-bottom: 20px;">
                            Makanan <span id="modal-food-count">0</span>/<span id="modal-food-total">2</span>
                        </div>
                        <div id="modal-drink">
                            Minuman <span id="modal-drink-count">0</span>/<span id="modal-drink-total">1</span>
                        </div>
                    </div>
                </div>
                <button id="closeModalBtn" style="
                    position: absolute;
                    top: 30px;
                    right: 30px;
                    background: rgba(255, 255, 255, 0.2);
                    border: 2px solid white;
                    color: white;
                    width: 50px;
                    height: 50px;
                    border-radius: 50%;
                    font-size: 24px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                ">×</button>
            </div>
        </div>

        <div style="
            width: 1000px;
            height: auto;
            background-image: url('assets/bg.png');
            background-size: contain;
            background-position: center center;
            background-repeat: no-repeat;
            /* border: 10px solid white; */
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            padding: 32px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 800px;
        ">

        <!-- Grid Etalase Makanan -->
            <div id="foodGrid" style="
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 3.1em .2em;
                margin-top: 110px;
                padding: 10px;
            ">
            </div>

       
        <!-- <div class="bg-yellow-50 rounded-2xl shadow-xl p-8 mb-8 border-2 border-yellow-300">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3">
                    <div class="w-4 h-4 bg-pink-600 rounded-full shadow-sm"></div>
                    <span class="text-lg font-bold text-purple-800">Progress Review</span>
                </div>
                <div class="bg-red-600 text-white px-6 py-2 rounded-lg font-bold text-lg shadow-lg">
                    <span id="progressText">1 / 1</span>
                </div>
            </div>
            <div class="w-full bg-pink-200 rounded-full h-6 overflow-hidden shadow-inner">
                <div id="progressBar" class="progress-bar-animated h-6 rounded-full transition-all duration-1000 ease-out shadow-lg glow-effect" style="width: 0%"></div>
            </div>
        </div>


        <div class="bg-cyan-50 rounded-2xl shadow-2xl p-10 mb-8 border-2 border-cyan-300 transform hover:shadow-3xl transition-all duration-500">
            <div class="text-center">
                <div class="mb-8">
                    <div class="inline-block bg-indigo-600 text-white px-6 py-3 rounded-xl text-lg font-bold shadow-lg">
                        Pertanyaan <span id="questionNumber">1</span> dari <span id="totalQuestions">1</span>
                    </div>
                </div>
                
                <div class="bg-emerald-50 rounded-2xl p-8 mb-8 border-2 border-emerald-300 shadow-inner">
                    <h2 id="questionText" class="text-3xl font-bold text-emerald-900 mb-8 leading-relaxed">
                        
                    </h2>
                </div>
            </div>
        </div>

  
        <div class="flex justify-between items-center mb-12">
            <button id="prevBtn" 
                class="group bg-violet-600 text-white px-10 py-5 rounded-2xl hover:bg-violet-700 focus:outline-none focus:ring-4 focus:ring-violet-300 focus:ring-offset-2 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed shadow-xl hover:shadow-2xl transform hover:scale-105 disabled:hover:scale-100">
                <div class="flex items-center gap-3">
                    <span class="text-2xl font-bold">←</span>
                    <span class="text-xl font-bold">Sebelumnya</span>
                </div>
            </button> -->
            
            <!-- <div class="flex items-center gap-6">
                <div class="text-center">
                    <div class="text-sm text-purple-600 mb-2 font-semibold">Keyboard Shortcuts</div>
                    <div class="flex gap-3">
                        <span class="bg-orange-200 text-orange-800 px-3 py-2 rounded-lg text-sm font-bold">←</span>
                        <span class="bg-orange-200 text-orange-800 px-3 py-2 rounded-lg text-sm font-bold">→</span>
                    </div>
                </div>
            </div> 
            
            <button id="nextBtn" 
                class="group bg-rose-600 text-white px-10 py-5 rounded-2xl hover:bg-rose-700 focus:outline-none focus:ring-4 focus:ring-rose-300 focus:ring-offset-2 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed shadow-xl hover:shadow-2xl transform hover:scale-105 disabled:hover:scale-100">
                <div class="flex items-center gap-3">
                    <span id="nextBtnText" class="text-xl font-bold">Selanjutnya</span>
                    <span id="nextBtnIcon" class="text-2xl font-bold">→</span>
                </div>
            </button>-->
        </div>


        <div id="resultsSection" class="hidden">
            <div class="celebration-bg rounded-2xl shadow-2xl p-10 mb-8 border-4 border-yellow-300 slide-in">
                <div class="text-center">
                    
                    <!-- Winner Announcement -->
                    <div id="winnerAnnouncement" class="bg-white bg-opacity-95 rounded-2xl p-8 mb-8 border-4 border-yellow-400 shadow-2xl pulse-animation">
                        <div class="text-center">
                            <div class="text-5xl mb-4">🏆</div>
                            <h4 class="text-3xl font-bold text-gray-800 mb-2">PEMENANG UTAMA</h4>
                            <div id="winnerName" class="text-4xl font-black text-yellow-600 winner-crown"></div>
                            <div id="winnerScore" class="text-2xl font-bold text-gray-700 mt-2"></div>
                        </div>
                    </div>
                    
                    <!-- Results Table -->
                    <div class="bg-white bg-opacity-95 rounded-2xl p-8 mb-8 border-4 border-blue-300 shadow-2xl">
                        <h3 class="text-3xl font-bold text-gray-900 mb-8 text-center">🏅 Peringkat Semua Peserta 🏅</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse">
                                <thead>
                                    <tr class="bg-gradient-to-r from-purple-500 via-pink-500 to-red-500 text-white">
                                        <th class="border border-gray-300 px-8 py-6 text-left font-bold text-xl">Peringkat</th>
                                        <th class="border border-gray-300 px-8 py-6 text-left font-bold text-xl">Peserta</th>
                                        <th class="border border-gray-300 px-8 py-6 text-center font-bold text-xl">Skor</th>
                                    </tr>
                                </thead>
                                <tbody id="resultsTableBody">
                                    <!-- Results will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="flex justify-center gap-6">
                        <button id="backToQuiz" 
                            class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-12 py-6 rounded-2xl hover:from-purple-700 hover:to-pink-700 focus:outline-none focus:ring-4 focus:ring-purple-300 focus:ring-offset-2 transition-all duration-300 shadow-xl hover:shadow-2xl transform hover:scale-105 pulse-animation">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl">🔄</span>
                                <span class="text-xl font-bold">Kembali ke Kuis</span>
                            </div>
                        </button>
                        
                        <button id="celebrateBtn" 
                            class="bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-12 py-6 rounded-2xl hover:from-yellow-600 hover:to-orange-600 focus:outline-none focus:ring-4 focus:ring-yellow-300 focus:ring-offset-2 transition-all duration-300 shadow-xl hover:shadow-2xl transform hover:scale-105">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl">🎊</span>
                                <span class="text-xl font-bold">Rayakan Lagi!</span>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>



    </div>

    <!-- Tombol Buat Sesi Baru -->
    <div style="
        position: absolute;
        bottom: 20px;
        right: 20px;
    ">
        <button id="newSessionBtn" style="
            background-color: #CB6917;
            color: #ffffff;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        ">
            Buat Sesi Baru
        </button>
    </div>
    </div>

    <script src="script.js"></script>
    <script>
        let questions = [];
        let participants = [];
        let answers = {}; // Format: { participantIndex: { questionIndex: answer } }
        let currentQuestionIndex = 0;
        let currentParticipantIndex = 0;

        let participantsData = [null, null]; // Array untuk menyimpan data 2 partisipan

        $(document).ready(function() {
            loadParticipants();
            renderFoodItems();
            loadQuestions();
            initializeEventListeners();
            initializeParticipantCards();
            updateParticipantDisplay();
        });

        function saveParticipants() {
            localStorage.setItem('participantsData', JSON.stringify(participantsData));
        }

        function loadParticipants() {
            const saved = localStorage.getItem('participantsData');
            if (saved) {
                try {
                    participantsData = JSON.parse(saved);
                } catch (e) {
                    participantsData = [null, null];
                }
            }
        }

        function initializeParticipantCards() {
            $('.participant-card').on('click', function() {
                const participantIndex = parseInt($(this).data('participant'));
                const participant = participantsData[participantIndex];
                
                if (!participant) {
                    // Jika belum ada, tampilkan form untuk menambah partisipan
                    addParticipant(participantIndex);
                } else {
                    // Jika sudah ada, tampilkan modal avatar full screen
                    showParticipantModal(participantIndex);
                }
            });
            
            // Clear button handler
            $('.clear-participant-btn').on('click', function(e) {
                e.stopPropagation(); // Prevent card click event
                const participantIndex = parseInt($(this).data('participant'));
                clearParticipant(participantIndex);
            });
            
            // Close modal handlers
            $('#closeModalBtn').on('click', function() {
                hideParticipantModal();
            });
            
            $('#participantModal').on('click', function(e) {
                if (e.target === this) {
                    hideParticipantModal();
                }
            });
        }
        
        function clearParticipant(index) {
            Swal.fire({
                title: 'Hapus Partisipan?',
                text: 'Data partisipan akan dihapus',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Hapus',
                cancelButtonText: 'Batal',
                confirmButtonColor: '#d32f2f'
            }).then((result) => {
                if (result.isConfirmed) {
                    participantsData[index] = null;
                    saveParticipants();
                    updateParticipantDisplay();
                }
            });
        }
        
        function showParticipantModal(index) {
            const participant = participantsData[index];
            if (!participant) return;
            
            // Calculate food and drink counts
            const foodItems = menuItems.filter(item => item.type === 'makanan');
            const drinkItems = menuItems.filter(item => item.type === 'minuman');
            
            const selectedFood = participant.items ? participant.items.filter(item => {
                const menuItem = menuItems.find(m => m.id === item.itemId);
                return menuItem && menuItem.type === 'makanan';
            }).length : 0;
            
            const selectedDrink = participant.items ? participant.items.filter(item => {
                const menuItem = menuItems.find(m => m.id === item.itemId);
                return menuItem && menuItem.type === 'minuman';
            }).length : 0;
            
            // Set avatar
            const avatarUrl = `https://api.dicebear.com/9.x/notionists-neutral/svg?seed=${encodeURIComponent(participant.name)}`;
            $('#modal-avatar').attr('src', avatarUrl);
            
            // Set name
            $('#modal-name').text(participant.name);
            
            // Set counts
            $('#modal-food-count').text(selectedFood);
            $('#modal-food-total').text(2);
            $('#modal-drink-count').text(selectedDrink);
            $('#modal-drink-total').text(1);
            
            // Show modal
            $('#participantModal').addClass('show');
        }
        
        function hideParticipantModal() {
            $('#participantModal').removeClass('show');
        }

        function addParticipant(index) {
            Swal.fire({
                title: 'Tambah Partisipan',
                input: 'text',
                inputLabel: 'Nama Partisipan',
                inputPlaceholder: 'Masukkan nama',
                showCancelButton: true,
                confirmButtonText: 'Simpan',
                cancelButtonText: 'Batal',
                inputValidator: (value) => {
                    if (!value || value.trim() === '') {
                        return 'Harap masukkan nama!';
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    participantsData[index] = {
                        name: result.value,
                        total: 0,
                        items: []
                    };
                    saveParticipants();
                    updateParticipantDisplay();
                }
            });
        }

        function editParticipant(index) {
            Swal.fire({
                title: 'Edit Partisipan',
                text: 'Pilih aksi',
                showCancelButton: true,
                showDenyButton: true,
                confirmButtonText: 'Edit Nama',
                denyButtonText: 'Hapus',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Edit nama
                    Swal.fire({
                        title: 'Edit Nama',
                        input: 'text',
                        inputLabel: 'Nama Partisipan',
                        inputValue: participantsData[index].name,
                        showCancelButton: true,
                        confirmButtonText: 'Simpan',
                        cancelButtonText: 'Batal',
                        inputValidator: (value) => {
                            if (!value || value.trim() === '') {
                                return 'Harap masukkan nama!';
                            }
                        }
                    }).then((editResult) => {
                        if (editResult.isConfirmed) {
                            participantsData[index].name = editResult.value;
                            saveParticipants();
                            updateParticipantDisplay();
                        }
                    });
                } else if (result.isDenied) {
                    // Hapus partisipan
                    Swal.fire({
                        title: 'Hapus Partisipan?',
                        text: 'Data partisipan akan dihapus',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonText: 'Hapus',
                        cancelButtonText: 'Batal'
                    }).then((deleteResult) => {
                        if (deleteResult.isConfirmed) {
                            participantsData[index] = null;
                            saveParticipants();
                            updateParticipantDisplay();
                        }
                    });
                }
            });
        }

        function clearSession() {
            Swal.fire({
                title: 'Buat Sesi Baru?',
                text: 'Semua data partisipan dan item yang dipilih akan dihapus. Tindakan ini tidak dapat dibatalkan.',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Ya, Hapus Semua',
                cancelButtonText: 'Batal',
                confirmButtonColor: '#d32f2f',
                cancelButtonColor: '#6c757d'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Reset participantsData
                    participantsData = [null, null];
                    
                    // Clear localStorage
                    localStorage.removeItem('participantsData');
                    
                    // Update tampilan
                    updateParticipantDisplay();
                    
                    // Show success message
                    Swal.fire({
                        title: 'Berhasil!',
                        text: 'Semua data telah dihapus. Sesi baru siap digunakan.',
                        icon: 'success',
                        confirmButtonText: 'OK',
                        confirmButtonColor: '#4CAF50'
                    });
                }
            });
        }

        function updateParticipantDisplay() {
            const foodItems = menuItems.filter(item => item.type === 'makanan');
            const drinkItems = menuItems.filter(item => item.type === 'minuman');
            
            for (let i = 0; i < 2; i++) {
                const participant = participantsData[i];
                const $card = $(`.participant-card[data-participant="${i}"]`);
                const $placeholder = $(`#participant-placeholder-${i}`);
                const $info = $(`#participant-info-${i}`);
                const $name = $(`#participant-name-${i}`);
                const $avatar = $(`#participant-avatar-${i}`);
                const $foodCount = $(`#participant-food-count-${i}`);
                const $foodTotal = $(`#participant-food-total-${i}`);
                const $drinkCount = $(`#participant-drink-count-${i}`);
                const $drinkTotal = $(`#participant-drink-total-${i}`);
                
                if (participant) {
                    // Tampilkan info partisipan
                    $card.removeClass('has-placeholder');
                    $placeholder.hide();
                    $info.addClass('show');
                    
                    $name.text(participant.name);
                    
                    // Set avatar menggunakan nama sebagai seed
                    const avatarUrl = `https://api.dicebear.com/9.x/notionists-neutral/svg?seed=${encodeURIComponent(participant.name)}`;
                    $avatar.attr('src', avatarUrl);
                    
                    // Calculate food and drink counts
                    const selectedFood = participant.items ? participant.items.filter(item => {
                        const menuItem = menuItems.find(m => m.id === item.itemId);
                        return menuItem && menuItem.type === 'makanan';
                    }).length : 0;
                    
                    const selectedDrink = participant.items ? participant.items.filter(item => {
                        const menuItem = menuItems.find(m => m.id === item.itemId);
                        return menuItem && menuItem.type === 'minuman';
                    }).length : 0;
                    
                    $foodCount.text(selectedFood);
                    $foodTotal.text(2);
                    $drinkCount.text(selectedDrink);
                    $drinkTotal.text(1);
                } else {
                    // Tampilkan placeholder
                    $card.addClass('has-placeholder');
                    $placeholder.show();
                    $info.removeClass('show');
                    $avatar.attr('src', '');
                }
            }
        }

        function renderFoodItems() {
            const $foodGrid = $('#foodGrid');
            $foodGrid.empty();
            
            menuItems.forEach(function(item) {
                const $foodItem = $('<div>')
                    .addClass('food-item')
                    .attr('id', item.id);
                const $img = $('<img>').attr({
                    'src': item.image,
                    'alt': item.name
                });
                $foodItem.append($img);
                $foodItem.on('click', function() {
                    showItemInput(item);
                });
                $foodGrid.append($foodItem);
            });
            
            applyRandomRotation();
        }

        function showItemInput(item) {
            const availableParticipants = participantsData.filter(p => p !== null);
            
            if (availableParticipants.length === 0) {
                Swal.fire({
                    title: 'Belum Ada Partisipan',
                    text: 'Silakan tambahkan partisipan terlebih dahulu',
                    icon: 'info',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            // Buat HTML untuk daftar partisipan
            let participantOptions = '';
            availableParticipants.forEach((participant, index) => {
                const participantIndex = participantsData.indexOf(participant);
                const avatarUrl = `https://api.dicebear.com/9.x/notionists-neutral/svg?seed=${encodeURIComponent(participant.name)}`;
                participantOptions += `
                    <div class="participant-option" style="
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        padding: 12px;
                        margin-bottom: 8px;
                        border: 2px solid #e0e0e0;
                        border-radius: 12px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    " data-index="${participantIndex}">
                        <img src="${avatarUrl}" alt="${participant.name}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                        <div style="flex: 1;">
                            <div style="font-weight: bold; font-size: 14px; color: #333;">${participant.name}</div>
                        </div>
                    </div>
                `;
            });
            
            Swal.fire({
                title: item.name,
                html: `
                    <div style="margin-bottom: 20px;">
                        ${participantOptions}
                    </div>
                    <div style="width: 100%; margin-top: 20px; padding: 0 20px; box-sizing: border-box;">
                        <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333; font-size: 14px;">Tebak Harga (Rp)</label>
                        <input type="number" id="swal-item-price" class="swal2-input" placeholder="Masukkan tebakan harga" min="0" step="100" style="width: 100%; box-sizing: border-box; margin: 0;">
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Simpan',
                cancelButtonText: 'Batal',
                didOpen: () => {
                    let selectedParticipantIndex = null;
                    
                    // Event handler untuk select participant
                    document.querySelectorAll('.participant-option').forEach(option => {
                        option.addEventListener('click', function() {
                            document.querySelectorAll('.participant-option').forEach(opt => {
                                opt.style.borderColor = '#e0e0e0';
                                opt.style.backgroundColor = 'transparent';
                            });
                            this.style.borderColor = '#4CAF50';
                            this.style.backgroundColor = '#f1f8f4';
                            selectedParticipantIndex = parseInt(this.dataset.index);
                        });
                    });
                    
                    // Store selected index untuk digunakan di preConfirm
                    window.swalSelectedParticipant = null;
                    document.querySelectorAll('.participant-option').forEach(option => {
                        option.addEventListener('click', function() {
                            window.swalSelectedParticipant = parseInt(this.dataset.index);
                        });
                    });
                },
                preConfirm: () => {
                    const priceGuess = document.getElementById('swal-item-price').value;
                    const selectedIndex = window.swalSelectedParticipant;
                    
                    if (!selectedIndex && selectedIndex !== 0) {
                        Swal.showValidationMessage('Pilih partisipan terlebih dahulu!');
                        return false;
                    }
                    
                    if (!priceGuess || priceGuess <= 0) {
                        Swal.showValidationMessage('Harap masukkan tebakan harga yang valid!');
                        return false;
                    }
                    
                    return {
                        participantIndex: selectedIndex,
                        quantity: 1, // Setiap item selalu quantity 1
                        priceGuess: parseInt(priceGuess)
                    };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const { participantIndex, quantity, priceGuess } = result.value;
                    const participant = participantsData[participantIndex];
                    
                    if (!participant.items) {
                        participant.items = [];
                    }
                    
                    // Check if item already exists
                    const existingItemIndex = participant.items.findIndex(i => i.itemId === item.id);
                    
                    if (existingItemIndex !== -1) {
                        // Update existing item quantity and price guess
                        participant.items[existingItemIndex].quantity = quantity;
                        participant.items[existingItemIndex].priceGuess = priceGuess;
                    } else {
                        // Check limit and remove old items if exceeds limit
                        const foodItems = participant.items.filter(i => {
                            const menuItem = menuItems.find(m => m.id === i.itemId);
                            return menuItem && menuItem.type === 'makanan';
                        });
                        
                        const drinkItems = participant.items.filter(i => {
                            const menuItem = menuItems.find(m => m.id === i.itemId);
                            return menuItem && menuItem.type === 'minuman';
                        });
                        
                        if (item.type === 'makanan' && foodItems.length >= 2) {
                            // Remove first food item
                            const firstFoodItem = foodItems[0];
                            const firstFoodIndex = participant.items.findIndex(i => {
                                const menuItem = menuItems.find(m => m.id === i.itemId);
                                return menuItem && menuItem.type === 'makanan' && i.itemId === firstFoodItem.itemId;
                            });
                            if (firstFoodIndex !== -1) {
                                participant.items.splice(firstFoodIndex, 1);
                            }
                        }
                        
                        if (item.type === 'minuman' && drinkItems.length >= 1) {
                            // Remove first drink item
                            const firstDrinkItem = drinkItems[0];
                            const firstDrinkIndex = participant.items.findIndex(i => {
                                const menuItem = menuItems.find(m => m.id === i.itemId);
                                return menuItem && menuItem.type === 'minuman' && i.itemId === firstDrinkItem.itemId;
                            });
                            if (firstDrinkIndex !== -1) {
                                participant.items.splice(firstDrinkIndex, 1);
                            }
                        }
                        
                        // Add new item to participant
                        participant.items.push({
                            itemId: item.id,
                            itemName: item.name,
                            quantity: quantity,
                            price: item.price,
                            priceGuess: priceGuess
                        });
                    }
                    
                    // Update total
                    participant.total = participant.items.reduce((sum, item) => {
                        const menuItem = menuItems.find(m => m.id === item.itemId);
                        return sum + (menuItem ? menuItem.price * item.quantity : 0);
                    }, 0);
                    
                    saveParticipants();
                    updateParticipantDisplay();
                }
            });
        }

        function applyRandomRotation() {
            $('.food-item').each(function() {
                const randomAngle = (Math.random() * 10 - 5).toFixed(2);
                $(this).css('--hover-rotate', `${randomAngle}deg`);
            });
        }

        function loadQuestions() {
            questions = JSON.parse(localStorage.getItem('quizQuestions')) || [];
            
            // Load participants and answers from answer.html data
            const savedParticipants = localStorage.getItem('quizParticipants');
            if (savedParticipants) {
                participants = JSON.parse(savedParticipants);
            }

            const savedAnswers = localStorage.getItem('quizAnswers');
            if (savedAnswers) {
                answers = JSON.parse(savedAnswers);
            }
            
            if (questions.length === 0) {
                $('#noQuestionsMessage').removeClass('hidden');
                return;
            }
            
            showCurrentQuestion();
        }

        function initializeEventListeners() {
            // Navigation buttons
            $('#nextBtn').on('click', function() {
                if (currentQuestionIndex === questions.length - 1) {
                    showResults();
                } else {
                    nextQuestion();
                }
            });

            $('#prevBtn').on('click', function() {
                previousQuestion();
            });

            // Keyboard shortcuts
            $(document).on('keydown', function(e) {
                if (e.key === 'ArrowLeft' && !$('#prevBtn').prop('disabled')) {
                    previousQuestion();
                } else if (e.key === 'ArrowRight' && !$('#nextBtn').prop('disabled')) {
                    if (currentQuestionIndex === questions.length - 1) {
                        showResults();
                    } else {
                        nextQuestion();
                    }
                }
            });

            // Back to quiz button
            $('#backToQuiz').on('click', function() {
                backToQuiz();
            });
            
            // View Results button
            $('#viewResultsBtn').on('click', function() {
                showAllResults();
            });
            
            // New Session button
            $('#newSessionBtn').on('click', function() {
                clearSession();
            });

        }

        function showAllResults() {
            const availableParticipants = participantsData.filter(p => p !== null);
            
            if (availableParticipants.length === 0) {
                Swal.fire({
                    title: 'Belum Ada Partisipan',
                    text: 'Silakan tambahkan partisipan terlebih dahulu',
                    icon: 'info',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            if (availableParticipants.length === 0) {
                Swal.fire({
                    title: 'Belum Ada Partisipan',
                    text: 'Silakan tambahkan partisipan terlebih dahulu',
                    icon: 'info',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            // Validasi: setiap partisipan harus memilih 2 makanan dan 1 minuman
            const incompleteParticipants = [];
            availableParticipants.forEach((participant, index) => {
                const foodItems = participant.items ? participant.items.filter(item => {
                    const menuItem = menuItems.find(m => m.id === item.itemId);
                    return menuItem && menuItem.type === 'makanan';
                }) : [];
                const drinkItems = participant.items ? participant.items.filter(item => {
                    const menuItem = menuItems.find(m => m.id === item.itemId);
                    return menuItem && menuItem.type === 'minuman';
                }) : [];
                
                if (foodItems.length !== 2 || drinkItems.length !== 1) {
                    incompleteParticipants.push({
                        name: participant.name,
                        foodCount: foodItems.length,
                        drinkCount: drinkItems.length
                    });
                }
            });
            
            // Jika ada partisipan yang belum lengkap, tampilkan alert
            if (incompleteParticipants.length > 0) {
                let messageHTML = '<div style="text-align: left; padding: 10px;">';
                messageHTML += '<p style="margin-bottom: 15px; font-weight: bold;">Beberapa partisipan belum memilih item lengkap:</p>';
                messageHTML += '<ul style="margin-left: 20px; margin-bottom: 15px;">';
                incompleteParticipants.forEach(p => {
                    messageHTML += `<li style="margin-bottom: 8px;">`;
                    messageHTML += `<strong>${p.name}</strong>: `;
                    messageHTML += `<span style="color: ${p.foodCount === 2 ? '#4CAF50' : '#d32f2f'}; font-weight: bold;">Makanan ${p.foodCount}/2</span>, `;
                    messageHTML += `<span style="color: ${p.drinkCount === 1 ? '#4CAF50' : '#d32f2f'}; font-weight: bold;">Minuman ${p.drinkCount}/1</span>`;
                    messageHTML += `</li>`;
                });
                messageHTML += '</ul>';
                messageHTML += '<p style="margin-top: 15px; color: #666; font-style: italic;">Setiap partisipan harus memilih tepat 2 makanan dan 1 minuman.</p>';
                messageHTML += '</div>';
                
                Swal.fire({
                    title: '⚠️ Data Belum Lengkap',
                    html: messageHTML,
                    icon: 'warning',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#FFA500',
                    width: '500px'
                });
                return;
            }
            
            // Hitung poin untuk setiap partisipan berdasarkan perbandingan per posisi item
            const participantScores = availableParticipants.map((participant, pIndex) => {
                let points = 0;
                let foodPoints = 0;
                let drinkPoints = 0;
                
                return {
                    participant: participant,
                    points: points,
                    foodCount: foodPoints,
                    drinkCount: drinkPoints
                };
            });
            
            // Tentukan jumlah item maksimal yang harus dibandingkan (3 item: 2 makanan + 1 minuman)
            const maxItemsToCompare = 3;
            
            // Bandingkan per posisi item (item ke-1 vs item ke-1, item ke-2 vs item ke-2, dst)
            for (let itemPosition = 0; itemPosition < maxItemsToCompare; itemPosition++) {
                const comparisons = [];
                
                // Kumpulkan item pada posisi ini dari setiap partisipan
                availableParticipants.forEach((participant, pIndex) => {
                    if (participant.items && participant.items[itemPosition]) {
                        const item = participant.items[itemPosition];
                        const menuItem = menuItems.find(m => m.id === item.itemId);
                        
                        if (menuItem && item.priceGuess !== undefined && item.priceGuess !== null && !isNaN(item.priceGuess)) {
                            const guess = parseInt(item.priceGuess);
                            const correctPrice = menuItem.price;
                            const difference = Math.abs(guess - correctPrice);
                            
                            comparisons.push({
                                participantIndex: pIndex,
                                itemId: item.itemId,
                                guess: guess,
                                correctPrice: correctPrice,
                                difference: difference,
                                itemType: menuItem.type
                            });
                        }
                    }
                });
                
                // Jika ada minimal 2 partisipan yang punya item di posisi ini, tentukan pemenang
                if (comparisons.length >= 2) {
                    // Cari selisih terkecil
                    const minDifference = Math.min(...comparisons.map(c => c.difference));
                    const winners = comparisons.filter(c => c.difference === minDifference);
                    
                    // Berikan poin ke pemenang (jika ada tie, semua yang tie dapat poin)
                    winners.forEach(winner => {
                        participantScores[winner.participantIndex].points++;
                        if (winner.itemType === 'makanan') {
                            participantScores[winner.participantIndex].foodCount++;
                        } else if (winner.itemType === 'minuman') {
                            participantScores[winner.participantIndex].drinkCount++;
                        }
                    });
                } else if (comparisons.length === 1) {
                    // Jika hanya 1 partisipan yang punya item di posisi ini, dia otomatis menang
                    const winner = comparisons[0];
                    participantScores[winner.participantIndex].points++;
                    if (winner.itemType === 'makanan') {
                        participantScores[winner.participantIndex].foodCount++;
                    } else if (winner.itemType === 'minuman') {
                        participantScores[winner.participantIndex].drinkCount++;
                    }
                }
            }
            
            // Sort berdasarkan poin tertinggi
            participantScores.sort((a, b) => b.points - a.points);
            
            // Tentukan pemenang (yang poinnya tertinggi)
            const maxPoints = participantScores.length > 0 ? participantScores[0].points : 0;
            const winners = participantScores.filter(p => p.points === maxPoints);
            
            let resultsHTML = '';
            
            // Trigger confetti jika ada pemenang dengan poin > 0
            const shouldTriggerConfetti = maxPoints > 0;
            
            // Tampilkan pemenang terlebih dahulu
            if (winners.length > 0 && maxPoints > 0) {
                resultsHTML += `
                    <div style="
                        background: #FFD700;
                        border-radius: 20px;
                        padding: 25px;
                        margin-bottom: 25px;
                        box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4);
                        color: white;
                        border: 3px solid #FFD700;
                    ">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 48px; margin-bottom: 10px;">🏆</div>
                            <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">PEMENANG</div>
                            <div style="font-size: 32px; font-weight: bold;">${winners.map(w => w.participant.name).join(', ')}</div>
                            <div style="font-size: 20px; margin-top: 10px; opacity: 0.9;">${maxPoints} Poin</div>
                        </div>
                    </div>
                `;
            }
            
            // Tampilkan semua partisipan dengan ranking
            participantScores.forEach((scoreData, index) => {
                const participant = scoreData.participant;
                const avatarUrl = `https://api.dicebear.com/9.x/notionists-neutral/svg?seed=${encodeURIComponent(participant.name)}`;
                const foodItems = participant.items ? participant.items.filter(item => {
                    const menuItem = menuItems.find(m => m.id === item.itemId);
                    return menuItem && menuItem.type === 'makanan';
                }) : [];
                const drinkItems = participant.items ? participant.items.filter(item => {
                    const menuItem = menuItems.find(m => m.id === item.itemId);
                    return menuItem && menuItem.type === 'minuman';
                }) : [];
                
                const rank = index + 1;
                // Hanya juara 1 yang dianggap sebagai pemenang (background hijau)
                const isWinner = rank === 1 && maxPoints > 0;
                let rankIcon = '';
                
                if (rank === 1 && maxPoints > 0) {
                    rankIcon = '🥇';
                } else if (rank === 2 && participantScores.length >= 2) {
                    rankIcon = '🥈';
                } else if (rank === 3 && participantScores.length >= 3) {
                    rankIcon = '🥉';
                }
                
                resultsHTML += `
                    <div style="
                        background: ${isWinner ? '#4CAF50' : 'white'};
                        border-radius: 20px;
                        padding: 20px;
                        margin-bottom: 20px;
                        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
                        color: ${isWinner ? 'white' : '#333'};
                        transition: transform 0.3s ease;
                        ${isWinner ? 'border: 3px solid #FFD700;' : ''}
                    ">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="
                                width: 70px;
                                height: 70px;
                                border-radius: 50%;
                                border: 4px solid ${isWinner ? '#FFD700' : '#e0e0e0'};
                                overflow: hidden;
                                background: ${isWinner ? 'rgba(255, 255, 255, 0.3)' : '#f5f5f5'};
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            ">
                                <img src="${avatarUrl}" alt="${participant.name}" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                                    ${rankIcon ? `<span style="font-size: 24px;">${rankIcon}</span>` : ''}
                                    <div style="font-weight: bold; font-size: 20px; color: ${isWinner ? 'white' : '#333'};">
                                        ${participant.name}
                                    </div>
                                </div>
                                <div style="
                                    background: ${isWinner ? 'rgba(255, 255, 255, 0.3)' : '#f0f0f0'};
                                    padding: 8px 15px;
                                    border-radius: 20px;
                                    display: inline-block;
                                    font-size: 16px;
                                    font-weight: bold;
                                    color: ${isWinner ? 'white' : '#333'};
                                ">
                                    ${scoreData.points} Poin
                                </div>
                            </div>
                        </div>
                        <div style="
                            background: ${isWinner ? 'rgba(255, 255, 255, 0.2)' : '#f9f9f9'};
                            border-radius: 15px;
                            padding: 15px;
                        ">
                            ${foodItems.length > 0 ? `
                                <div style="margin-bottom: 10px;">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                        <span style="font-size: 18px;"></span>
                                        <span style="font-weight: bold; font-size: 14px; color: ${isWinner ? 'white' : '#333'};">Makanan:</span>
                                        <span style="font-size: 14px; color: ${isWinner ? 'rgba(255, 255, 255, 0.9)' : '#666'};">(${scoreData.foodCount} poin)</span>
                                    </div>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-left: 26px;">
                                        ${foodItems.map(item => {
                                            const menuItem = menuItems.find(m => m.id === item.itemId);
                                            const correctPrice = menuItem ? menuItem.price : 0;
                                            const priceGuess = item.priceGuess || 0;
                                            return `
                                                <span style="
                                                    background: ${isWinner ? 'rgba(255, 255, 255, 0.3)' : '#e8e8e8'};
                                                    padding: 6px 12px;
                                                    border-radius: 15px;
                                                    font-size: 12px;
                                                    font-weight: 500;
                                                    color: ${isWinner ? 'white' : '#333'};
                                                ">
                                                    ${menuItem ? menuItem.name : item.itemName} × ${item.quantity}<br>
                                                    <small style="font-size: 10px; opacity: ${isWinner ? '0.9' : '1'};">Tebak: Rp ${priceGuess.toLocaleString('id-ID')} | Benar: Rp ${correctPrice.toLocaleString('id-ID')}</small>
                                                </span>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            ${drinkItems.length > 0 ? `
                                <div>
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                        <span style="font-size: 18px;"></span>
                                        <span style="font-weight: bold; font-size: 14px; color: ${isWinner ? 'white' : '#333'};">Minuman:</span>
                                        <span style="font-size: 14px; color: ${isWinner ? 'rgba(255, 255, 255, 0.9)' : '#666'};">(${scoreData.drinkCount} poin)</span>
                                    </div>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-left: 26px;">
                                        ${drinkItems.map(item => {
                                            const menuItem = menuItems.find(m => m.id === item.itemId);
                                            const correctPrice = menuItem ? menuItem.price : 0;
                                            const priceGuess = item.priceGuess || 0;
                                            return `
                                                <span style="
                                                    background: ${isWinner ? 'rgba(255, 255, 255, 0.3)' : '#e8e8e8'};
                                                    padding: 6px 12px;
                                                    border-radius: 15px;
                                                    font-size: 12px;
                                                    font-weight: 500;
                                                    color: ${isWinner ? 'white' : '#333'};
                                                ">
                                                    ${menuItem ? menuItem.name : item.itemName} × ${item.quantity}<br>
                                                    <small style="font-size: 10px; opacity: ${isWinner ? '0.9' : '1'};">Tebak: Rp ${priceGuess.toLocaleString('id-ID')} | Benar: Rp ${correctPrice.toLocaleString('id-ID')}</small>
                                                </span>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            ${(foodItems.length === 0 && drinkItems.length === 0) ? `
                                <div style="
                                    text-align: center;
                                    padding: 20px;
                                    font-size: 14px;
                                    opacity: 0.8;
                                    font-style: italic;
                                ">
                                    Belum memilih item
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            });
            
            Swal.fire({
                title: '',
                html: `
                    <div style="max-height: 65vh; overflow-y: auto; padding: 10px;">
                        ${resultsHTML}
                    </div>
                `,
                width: '650px',
                confirmButtonText: 'Tutup',
                confirmButtonColor: '#4CAF50',
                showCancelButton: false,
                customClass: {
                    popup: 'results-popup'
                },
                didOpen: () => {
                    // Trigger confetti setelah popup terbuka
                    if (shouldTriggerConfetti) {
                        // Delay untuk memastikan popup sudah fully rendered
                        setTimeout(() => {
                            triggerConfetti();
                        }, 1000);
                    }
                },
                willClose: () => {
                    // Pastikan confetti masih berjalan meski popup ditutup
                    if (shouldTriggerConfetti) {
                        // Trigger lagi saat akan menutup untuk efek lebih dramatis
                        setTimeout(() => {
                            triggerConfetti();
                        }, 100);
                    }
                }
            });
        }

        function showCurrentQuestion() {
            const question = questions[currentQuestionIndex];
            
            $('#questionText').text(question.question);
            $('#questionNumber').text(currentQuestionIndex + 1);
            $('#totalQuestions').text(questions.length);
            
            updateProgress();
            updateNavigationButtons();
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            $('#progressBar').css('width', progress + '%');
            $('#progressText').text(`${currentQuestionIndex + 1} / ${questions.length}`);
        }

        function updateNavigationButtons() {
            $('#prevBtn').prop('disabled', currentQuestionIndex === 0);
            
            if (currentQuestionIndex === questions.length - 1) {
                $('#nextBtnText').text('Lihat Hasil');

                $('#nextBtn').removeClass('bg-rose-600 hover:bg-rose-700 focus:ring-rose-300');
                $('#nextBtn').addClass('bg-green-600 hover:bg-green-700 focus:ring-green-300');
            } else {
                $('#nextBtnText').text('Selanjutnya');
                $('#nextBtnIcon').text('→');
                $('#nextBtn').removeClass('bg-green-600 hover:bg-green-700 focus:ring-green-300');
                $('#nextBtn').addClass('bg-rose-600 hover:bg-rose-700 focus:ring-rose-300');
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showCurrentQuestion();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showCurrentQuestion();
            }
        }

        function showResults() {
            // Hide quiz elements
            $('#progressBar').parent().parent().addClass('hidden');
            $('.bg-cyan-50').addClass('hidden');
            $('.flex.justify-between.items-center').addClass('hidden');
            
            // Show results
            $('#resultsSection').removeClass('hidden');
            
            // Calculate and display all results
            displayAllResults();
        }

        function displayAllResults() {
            const results = calculateResults();
            const $resultsBody = $('#resultsTableBody');
            
            $resultsBody.empty();
            
            if (results.length === 0) {
                $resultsBody.append(`
                    <tr>
                        <td colspan="3" class="border border-gray-300 px-6 py-8 text-center text-gray-500 text-lg">
                            Belum ada data peserta atau jawaban
                        </td>
                    </tr>
                `);
                return;
            }
            
            // Sort results by percentage (highest first)
            results.sort((a, b) => b.percentage - a.percentage);
            
            // Set winner announcement
            if (results.length > 0) {
                const winner = results[0];
                $('#winnerName').text(winner.name);
                $('#winnerScore').text(`${winner.correct}/${winner.total}`);
                
                // Trigger confetti for winner
                setTimeout(() => {
                    triggerConfetti();
                }, 500);
            }
            
            results.forEach((result, index) => {
                let percentageColor = '';
                let rowClass = '';
                
                if (result.percentage >= 80) {
                    percentageColor = 'text-green-600';
                    rowClass = 'bg-gradient-to-r from-green-50 to-emerald-50';
                } else if (result.percentage >= 60) {
                    percentageColor = 'text-yellow-600';
                    rowClass = 'bg-gradient-to-r from-yellow-50 to-orange-50';
                } else {
                    percentageColor = 'text-red-600';
                    rowClass = 'bg-gradient-to-r from-red-50 to-pink-50';
                }
                
                const rank = index + 1;
                let rankIcon = '';
                let rankClass = '';
                
                if (rank === 1) {
                    rankIcon = '🥇';
                    rankClass = 'font-black text-yellow-600 text-2xl';
                } else if (rank === 2) {
                    rankIcon = '🥈';
                    rankClass = 'font-bold text-gray-500 text-xl';
                } else if (rank === 3) {
                    rankIcon = '🥉';
                    rankClass = 'font-bold text-orange-600 text-xl';
                } else {
                    rankIcon = '🏅';
                    rankClass = 'font-semibold text-gray-600 text-lg';
                }
                
                $resultsBody.append(`
                    <tr class="${rowClass} hover:shadow-lg transition-all duration-300 transform hover:scale-105">
                        <td class="border border-gray-300 px-8 py-6 text-center ${rankClass}">
                            ${rankIcon}
                        </td>
                        <td class="border border-gray-300 px-8 py-6 font-bold text-xl text-gray-800">
                            ${result.name}
                        </td>
                        <td class="border border-gray-300 px-8 py-6 text-center font-bold text-2xl text-gray-700">
                            ${result.correct} / ${result.total}
                        </td>
                    </tr>
                `);
            });
            
            // Add celebrate button event listener
            $('#celebrateBtn').off('click').on('click', function() {
                triggerConfetti();
                playCelebrationSound();
            });
        }

        function backToQuiz() {
            // Show quiz elements
            $('#progressBar').parent().parent().removeClass('hidden');
            $('.bg-cyan-50').removeClass('hidden');
            $('.flex.justify-between.items-center').removeClass('hidden');
            
            // Hide results
            $('#resultsSection').addClass('hidden');
        }

        function calculateResults() {
            if (participants.length === 0) {
                return [];
            }

            const results = [];

            participants.forEach((participant, pIndex) => {
                let correct = 0;
                
                questions.forEach((question, qIndex) => {
                    const userAnswer = answers[pIndex] && answers[pIndex][qIndex] !== undefined 
                        ? answers[pIndex][qIndex] 
                        : null;
                    
                    if (userAnswer !== null && isAnswerCorrect(question, userAnswer, qIndex, pIndex)) {
                        correct++;
                    }
                });

                const percentage = Math.round((correct / questions.length) * 100);
                results.push({
                    name: participant,
                    correct: correct,
                    total: questions.length,
                    percentage: percentage
                });
            });

            return results;
        }

        function isAnswerCorrect(question, userAnswer, questionIndex, participantIndex) {
            const correctAnswer = question.answer;
            
            // Kumpulkan semua jawaban dari partisipan untuk pertanyaan ini
            const allAnswersForQuestion = [];
            participants.forEach((p, pIndex) => {
                if (pIndex !== participantIndex && answers[pIndex] && answers[pIndex][questionIndex] !== undefined) {
                    allAnswersForQuestion.push(answers[pIndex][questionIndex]);
                }
            });

            // Algoritma penilaian
            const lowerAnswers = allAnswersForQuestion.filter(answer => answer < correctAnswer);
            
            if (lowerAnswers.length > 0) {
                const maxLowerAnswer = Math.max(...lowerAnswers);
                return userAnswer === maxLowerAnswer;
            } else {
                const higherAnswers = allAnswersForQuestion.filter(answer => answer > correctAnswer);
                if (higherAnswers.length > 0) {
                    const minHigherAnswer = Math.min(...higherAnswers);
                    return userAnswer === minHigherAnswer;
                } else {
                    return userAnswer === correctAnswer;
                }
            }
        }

        // Confetti effect function
        function triggerConfetti() {
            // Pastikan library confetti tersedia
            if (typeof confetti === 'undefined') {
                console.error('Confetti library not loaded');
                return;
            }
            
            // Set z-index tinggi untuk semua canvas confetti yang dibuat
            setTimeout(() => {
                const confettiCanvases = document.querySelectorAll('canvas[id^="confetti"]');
                confettiCanvases.forEach(canvas => {
                    canvas.style.zIndex = '999999';
                    canvas.style.pointerEvents = 'none';
                });
            }, 100);
            
            // Multiple confetti bursts dari tengah
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    confetti({
                        particleCount: 150,
                        spread: 90,
                        origin: { y: 0.6, x: 0.5 },
                        colors: ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff', '#FFD700']
                    });
                    
                    // Set z-index setelah confetti dibuat
                    setTimeout(() => {
                        const canvases = document.querySelectorAll('canvas');
                        canvases.forEach(canvas => {
                            if (canvas.style.position === 'fixed' || canvas.style.position === '') {
                                canvas.style.zIndex = '999999';
                                canvas.style.pointerEvents = 'none';
                            }
                        });
                    }, 50);
                }, i * 150);
            }
            
            // Burst dari kiri
            setTimeout(() => {
                confetti({
                    particleCount: 80,
                    angle: 60,
                    spread: 70,
                    origin: { x: 0, y: 0.5 },
                    colors: ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#FFD700']
                });
            }, 400);
            
            // Burst dari kanan
            setTimeout(() => {
                confetti({
                    particleCount: 80,
                    angle: 120,
                    spread: 70,
                    origin: { x: 1, y: 0.5 },
                    colors: ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#FFD700']
                });
            }, 600);
            
            // Burst dari atas
            setTimeout(() => {
                confetti({
                    particleCount: 100,
                    angle: 90,
                    spread: 80,
                    origin: { x: 0.5, y: 0 },
                    colors: ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#FFD700']
                });
            }, 800);
        }

        // Celebration sound effect (using Web Audio API)
        function playCelebrationSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Create a simple celebration sound
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Create a rising melody
                const frequencies = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
                
                frequencies.forEach((freq, index) => {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    
                    osc.frequency.setValueAtTime(freq, audioContext.currentTime);
                    osc.type = 'sine';
                    
                    gain.gain.setValueAtTime(0, audioContext.currentTime);
                    gain.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.1);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    osc.start(audioContext.currentTime + index * 0.1);
                    osc.stop(audioContext.currentTime + index * 0.1 + 0.5);
                });
            } catch (error) {
                console.log('Audio not supported or blocked');
            }
        }
    </script>
</body>
</html>
